<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Swift Source Code Analysis - Sort | Mini灬哆啦</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Swift源码分析-Sort排序">
<meta name="keywords" content="iOS,Swift 3.0">
<meta property="og:type" content="article">
<meta property="og:title" content="Swift Source Code Analysis - Sort">
<meta property="og:url" content="http://xwjack.github.io/2016/06/05/Swift-Source-Code-Analysis-Sort/index.html">
<meta property="og:site_name" content="Mini灬哆啦">
<meta property="og:description" content="Swift源码分析-Sort排序">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://o9omj1fgd.bkt.clouddn.com/blog/swift_source_sode_analysis_sort/images/quicksort_explanation.png">
<meta property="og:updated_time" content="2018-01-15T13:13:42.620Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Swift Source Code Analysis - Sort">
<meta name="twitter:description" content="Swift源码分析-Sort排序">
<meta name="twitter:image" content="http://o9omj1fgd.bkt.clouddn.com/blog/swift_source_sode_analysis_sort/images/quicksort_explanation.png">
  
    <link rel="alternative" href="/atom.xml" title="Mini灬哆啦" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/head.png" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/" title="Hi Mate">Mini灬哆啦</a></h1>
        </hgroup>

        
        
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl github" target="_blank" href="https://github.com/XWJACK" title="github">github</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">Mini灬哆啦</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.png" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">Mini灬哆啦</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="github" target="_blank" href="https://github.com/XWJACK" title="github">github</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-Swift-Source-Code-Analysis-Sort" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/05/Swift-Source-Code-Analysis-Sort/" class="article-date">
      <time datetime="2016-06-04T16:00:00.000Z" itemprop="datePublished">2016-06-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Swift Source Code Analysis - Sort
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Swift-3-0/">Swift 3.0</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS/">iOS</a></li></ul>
    </div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>Swift源码分析-Sort排序</p>
<a id="more"></a>
<h1 id="Swift源码分析-Sort"><a href="#Swift源码分析-Sort" class="headerlink" title="Swift源码分析 - Sort"></a>Swift源码分析 - Sort</h1><p>当我们在Swift中使用排序的时候,我们通常会这样使用:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> array = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">8</span>]</span><br><span class="line">array.<span class="built_in">sort</span>(&gt;)</span><br></pre></td></tr></table></figure>
<p>或者这样使用:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">8</span>]</span><br><span class="line">array.sorted(&gt;)</span><br></pre></td></tr></table></figure>
<p>速度非常的快,比快速排序,插入排序,堆排序等,都快很多.</p>
<p>当我看到Swift的源码的时候才知道为什么排序速度这么快.</p>
<h2 id="IntroSort-内省算法"><a href="#IntroSort-内省算法" class="headerlink" title="IntroSort(内省算法)"></a><a href="https://en.wikipedia.org/wiki/Introsort" target="_blank" rel="noopener">IntroSort(内省算法)</a></h2><h3 id="将sort-swift-gyb文件转换成sort-swift文件"><a href="#将sort-swift-gyb文件转换成sort-swift文件" class="headerlink" title="将sort.swift.gyb文件转换成sort.swift文件"></a>将sort.swift.gyb文件转换成sort.swift文件</h3><p>源码中很多文件不是用Swift写的,而是用Python写的,这个时候我们就要用工具进行转换了,转换的方法很简单.(源码中已经自带转换工具)，当然,如果你已经了解Python,那么你直接去源码路径查看就可以。</p>
<p>转换方法：</p>
<p><code>/swift/stdlib/public/core/Sort.swift.gyb</code></p>
<p>终端切换到工具目录下：</p>
<p><code>cd /swift/utils</code> </p>
<p><code>./gyb --line-directive &#39;&#39; -o sort.swift sort.swift.gyb</code></p>
<p>更多信息: <a href="https://www.uraimo.com/2016/02/09/a-short-swift-gyb-tutorial/" target="_blank" rel="noopener">Blog</a> or <a href="http://swift.gg/2016/03/04/a-short-swift-gyb-tutorial/" target="_blank" rel="noopener">SwiftGG</a>.</p>
<h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><p>我看到了很熟悉的排序算法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">_heapSort</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">_insertionSort</span></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">_partition</span></span></span><br></pre></td></tr></table></figure>
<p>应该是<strong>堆排序,插入排序,快速排序</strong>.</p>
<ul>
<li><strong>堆排序的优点:</strong>在任何情况下时间复杂度都是一样,稳定性高</li>
<li><strong>插入排序优点:</strong>在数量很少的情况下可以很快的完成</li>
<li><strong>快速排序优点:</strong>在数量很大的时候速度是最快的,但是不稳定</li>
</ul>
<p>这样可以推断出IntroSort算法其实是三者排序算法的综合应用.</p>
<p>但是这个文件中并没有sort函数,根据推断,我们在使用函数的时候都是在一个Collection中,也就是数组中,于是在源码中成功找到文件:</p>
<p><strong><code>CollectionAlgorithms.swift.gyb</code></strong></p>
<h4 id="sort-CollectionAlgorithms-swift"><a href="#sort-CollectionAlgorithms-swift" class="headerlink" title="sort - CollectionAlgorithms.swift"></a>sort - CollectionAlgorithms.swift</h4><p>而下面这个两个扩展中的sort函数, 都是创建新数组,然后修改返回,所以不会修改原数组,也就是我们经常使用的函数(默认<strong><code>MutableCollection</code></strong>和<strong><code>Sequence</code></strong>都实现了一样的方法):</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> <span class="title">where</span> <span class="title">Self</span>.<span class="title">Iterator</span>.<span class="title">Element</span> : <span class="title">Comparable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">sorted</span><span class="params">()</span></span> -&gt; [<span class="type">Iterator</span>.<span class="type">Element</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="type">ContiguousArray</span>(<span class="keyword">self</span>)</span><br><span class="line">    result.<span class="built_in">sort</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Array</span>(result)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Sequence</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">sorted</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    by areInIncreasingOrder:</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="params">(Iterator.Element, Iterator.Element)</span></span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">  ) -&gt; [<span class="type">Iterator</span>.<span class="type">Element</span>] &#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="type">ContiguousArray</span>(<span class="keyword">self</span>)</span><br><span class="line">    result.<span class="built_in">sort</span>(by: areInIncreasingOrder)</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Array</span>(result)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note: 由于sorted默认是从小到大排序，所以需要在第一个扩展中加上限定，使得元素可比较，但是第二个采用自定义比较方法，所以不需要加上扩展条件</p>
</blockquote>
<p>让我们回到核心代码上:</p>
<p>第一个:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">sort</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">let</span> didSortUnsafeBuffer: <span class="type">Void</span>? =</span><br><span class="line">     _withUnsafeMutableBufferPointerIfSupported &#123;</span><br><span class="line">     (baseAddress, <span class="built_in">count</span>) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">     <span class="keyword">var</span> bufferPointer =</span><br><span class="line">       <span class="type">UnsafeMutableBufferPointer</span>(start: baseAddress, <span class="built_in">count</span>: <span class="built_in">count</span>)</span><br><span class="line">     bufferPointer.<span class="built_in">sort</span>()</span><br><span class="line">     <span class="keyword">return</span> ()</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> didSortUnsafeBuffer == <span class="literal">nil</span> &#123;</span><br><span class="line">     _introSort(&amp;<span class="keyword">self</span>, subRange: startIndex..&lt;endIndex)</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>第二个:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">sort</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">   by areInIncreasingOrder:</span></span></span><br><span class="line"><span class="function"><span class="params">     <span class="params">(Iterator.Element, Iterator.Element)</span></span></span> -&gt; <span class="type">Bool</span></span><br><span class="line"> ) &#123;</span><br><span class="line">   <span class="keyword">typealias</span> <span class="type">EscapingBinaryPredicate</span> =</span><br><span class="line">     (<span class="type">Iterator</span>.<span class="type">Element</span>, <span class="type">Iterator</span>.<span class="type">Element</span>) -&gt; <span class="type">Bool</span></span><br><span class="line">   <span class="keyword">let</span> escapableIsOrderedBefore =</span><br><span class="line">     <span class="built_in">unsafeBitCast</span>(areInIncreasingOrder, to: <span class="type">EscapingBinaryPredicate</span>.<span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">let</span> didSortUnsafeBuffer: <span class="type">Void</span>? =</span><br><span class="line">     _withUnsafeMutableBufferPointerIfSupported &#123;</span><br><span class="line">     (baseAddress, <span class="built_in">count</span>) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">     <span class="keyword">var</span> bufferPointer =</span><br><span class="line">       <span class="type">UnsafeMutableBufferPointer</span>(start: baseAddress, <span class="built_in">count</span>: <span class="built_in">count</span>)</span><br><span class="line">     bufferPointer.<span class="built_in">sort</span>(by: escapableIsOrderedBefore)</span><br><span class="line">     <span class="keyword">return</span> ()</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> didSortUnsafeBuffer == <span class="literal">nil</span> &#123;</span><br><span class="line">     _introSort(</span><br><span class="line">       &amp;<span class="keyword">self</span>,</span><br><span class="line">       subRange: startIndex..&lt;endIndex,</span><br><span class="line">       by: escapableIsOrderedBefore)</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>分析:</p>
<ul>
<li><p>相同点:两个函数前面都加了一个关键字<strong>mutating</strong>表示是需要修改内容的因为这个扩展的不是Collection,而是MutableCollection.</p>
</li>
<li><p>不同点:</p>
<ol>
<li>第一个函数也就是不给定参数,默认排序为从小到大.</li>
<li>给定参数,按参数(其实就是闭包)进行排序.</li>
</ol>
</li>
</ul>
<p><code>_introSort(&amp;self, subRange: startIndex..&lt;endIndex)</code>开始调用introSort算法了</p>
<p>那这个闭包是干嘛的?</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="type">Iterator</span>.<span class="type">Element</span>, <span class="type">Iterator</span>.<span class="type">Element</span>) -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure>
<p>得到两个泛型的值,返回一个Bool值?很熟悉?在Swift中,<code>&lt;</code>号和<code>&gt;</code>号等都是函数,都是通过判断两个数,之后返回Bool类型,这就是为什么我们可以使用<code>&lt;</code>号或者<code>&gt;</code>号来进行简写sort函数了,<strong>这个在之后会详解</strong></p>
<h4 id="introSort-Sort-swift"><a href="#introSort-Sort-swift" class="headerlink" title="_introSort - Sort.swift"></a>_introSort - Sort.swift</h4><p>在源码中有这样一个函数</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">public</span> <span class="comment">// @testable</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">_introSort</span>&lt;C&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="number">_</span> elements: <span class="keyword">inout</span> C,</span></span></span><br><span class="line"><span class="function"><span class="params">  subRange range: Range&lt;C.Index&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">  </span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> <span class="keyword">where</span></span><br><span class="line">  <span class="type">C</span> : <span class="type">MutableCollection</span> &amp; <span class="type">RandomAccessCollection</span></span><br><span class="line">  , <span class="type">C</span>.<span class="type">Iterator</span>.<span class="type">Element</span> : <span class="type">Comparable</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="built_in">count</span> =</span><br><span class="line">    elements.<span class="built_in">distance</span>(from: range.lowerBound, to: range.upperBound).toIntMax()</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">count</span> &lt; <span class="number">2</span> &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Set max recursion depth to 2*floor(log(N)), as suggested in the introsort</span></span><br><span class="line">  <span class="comment">// paper: http://www.cs.rpi.edu/~musser/gp/introsort.ps</span></span><br><span class="line">  <span class="keyword">let</span> depthLimit = <span class="number">2</span> * _floorLog2(<span class="type">Int64</span>(<span class="built_in">count</span>))</span><br><span class="line">  _introSortImpl(</span><br><span class="line">    &amp;elements,</span><br><span class="line">    subRange: range,</span><br><span class="line">    </span><br><span class="line">    depthLimit: depthLimit)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>泛型符号是C,支持<strong><code>MutableCollection</code></strong>, <strong><code>RandomAccessCollection</code></strong>协议(A collection that supports efficient random-access index traversal.Random-access collections can measure move indices any distance and can measure the distance between indices in O(1) time)</p>
<p><code>let depthLimit = 2 * _floorLog2(Int64(count))</code>一个计算深度限制的方法,具体的意思在下面会说</p>
<p>下面是解释:</p>
<p><img src="http://o9omj1fgd.bkt.clouddn.com/blog/swift_source_sode_analysis_sort/images/quicksort_explanation.png" alt=""></p>
<p>大致意思是这样的:快速排序很快,但是最坏的情况下时间复杂度却很不好,这取决于partition的位置,当partition的位置小于限制深度的时候就采用堆排序来维持一个Nlog(N)的时间复杂度.</p>
<p>之后将参数传递给:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">_introSortImpl</span>&lt;C&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="number">_</span> elements: <span class="keyword">inout</span> C,</span></span></span><br><span class="line"><span class="function"><span class="params">  subRange range: Range&lt;C.Index&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">  ,</span></span></span><br><span class="line"><span class="function"><span class="params">  depthLimit: Int</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span><span class="keyword">where</span></span><br><span class="line">  <span class="type">C</span> : <span class="type">MutableCollection</span> &amp; <span class="type">RandomAccessCollection</span></span><br><span class="line">  , <span class="type">C</span>.<span class="type">Iterator</span>.<span class="type">Element</span> : <span class="type">Comparable</span></span><br></pre></td></tr></table></figure>
<p>这才是整个算法最核心的部分,也就是算法选择的部分.自动选择最优算法来进行排序,根据不同的场景来切换排序算法,达到最优的效果.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Insertion sort is better at handling smaller regions.</span></span><br><span class="line">  <span class="keyword">if</span> elements.<span class="built_in">distance</span>(from: range.lowerBound, to: range.upperBound) &lt; <span class="number">20</span> &#123;</span><br><span class="line">    _insertionSort(</span><br><span class="line">      &amp;elements,</span><br><span class="line">      subRange: range</span><br><span class="line">      )</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>从这句话我们可以看到限制深度保持在20,这正是插入排序的优点.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> depthLimit == <span class="number">0</span> &#123;</span><br><span class="line">   _heapSort(</span><br><span class="line">     &amp;elements,</span><br><span class="line">     subRange: range</span><br><span class="line">     )</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>当深度等于0的时候采用堆排序.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Partition and sort.</span></span><br><span class="line"> <span class="comment">// We don't check the depthLimit variable for underflow because this variable</span></span><br><span class="line"> <span class="comment">// is always greater than zero (see check above).</span></span><br><span class="line"> <span class="keyword">let</span> partIdx: <span class="type">C</span>.<span class="type">Index</span> = _partition(</span><br><span class="line">   &amp;elements,</span><br><span class="line">   subRange: range</span><br><span class="line">   )</span><br><span class="line"> _introSortImpl(</span><br><span class="line">   &amp;elements,</span><br><span class="line">   subRange: range.lowerBound..&lt;partIdx,</span><br><span class="line">   </span><br><span class="line">   depthLimit: depthLimit &amp;- <span class="number">1</span>)</span><br><span class="line"> _introSortImpl(</span><br><span class="line">   &amp;elements,</span><br><span class="line">   subRange: (elements.index(after: partIdx))..&lt;range.upperBound,</span><br><span class="line">   </span><br><span class="line">   depthLimit: depthLimit &amp;- <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>现在就是开始快速排序了,并且每趟快速排序完成之后都会重新将两个子序列进行<code>_introSort</code>,这样就达到了不同情况选择不同的排序算法:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">_partition</span>&lt;C&gt;<span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="number">_</span> elements: <span class="keyword">inout</span> C,</span></span></span><br><span class="line"><span class="function"><span class="params">  subRange range: Range&lt;C.Index&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">  </span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> -&gt; <span class="type">C</span>.<span class="type">Index</span></span><br><span class="line">  <span class="keyword">where</span></span><br><span class="line">  <span class="type">C</span> : <span class="type">MutableCollection</span> &amp; <span class="type">RandomAccessCollection</span></span><br><span class="line">  , <span class="type">C</span>.<span class="type">Iterator</span>.<span class="type">Element</span> : <span class="type">Comparable</span></span><br></pre></td></tr></table></figure>
<p>看看如何将一个数组分成两半的.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The first element is the pivot.</span></span><br><span class="line"> <span class="keyword">let</span> pivot = elements[range.lowerBound]</span><br></pre></td></tr></table></figure>
<p>这是偷懒么?优化不够啊!就不使用三点取中?,直接用第一个元素作为中轴?这也许有原因的:要么偷懒.要么就是没必要(多一个判断就多一次消耗时间,我认为这没有必要)</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// Loop invariants:</span></span><br><span class="line">  <span class="comment">// * lo &lt; hi</span></span><br><span class="line">  <span class="comment">// * elements[i] &lt; pivot, for i in range.lowerBound+1..lo</span></span><br><span class="line">  <span class="comment">// * pivot &lt;= elements[i] for i in hi..range.upperBound</span></span><br><span class="line"></span><br><span class="line"><span class="type">Loop</span>: <span class="keyword">while</span> <span class="literal">true</span> &#123;</span><br><span class="line">  <span class="type">FindLo</span>: <span class="keyword">repeat</span> &#123;</span><br><span class="line">      elements.formIndex(after: &amp;lo)</span><br><span class="line">      <span class="keyword">while</span> lo != hi &#123;</span><br><span class="line">        <span class="keyword">if</span> !(elements[lo] &lt; pivot) &#123; <span class="keyword">break</span> <span class="type">FindLo</span> &#125;</span><br><span class="line">        elements.formIndex(after: &amp;lo)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span> <span class="type">Loop</span></span><br><span class="line">    &#125; <span class="keyword">while</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="type">FindHi</span>: <span class="keyword">repeat</span> &#123;</span><br><span class="line">      elements.formIndex(before: &amp;hi)</span><br><span class="line">      <span class="keyword">while</span> hi != lo &#123;</span><br><span class="line">        <span class="keyword">if</span> (elements[hi] &lt; pivot) &#123; <span class="keyword">break</span> <span class="type">FindHi</span> &#125;</span><br><span class="line">        elements.formIndex(before: &amp;hi)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span> <span class="type">Loop</span></span><br><span class="line">    &#125; <span class="keyword">while</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">swap</span>(&amp;elements[lo], &amp;elements[hi])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  elements.formIndex(before: &amp;lo)</span><br><span class="line">  <span class="keyword">if</span> lo != range.lowerBound &#123;</span><br><span class="line">    <span class="comment">// swap the pivot into place</span></span><br><span class="line">    <span class="built_in">swap</span>(&amp;elements[lo], &amp;elements[range.lowerBound])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> lo</span><br><span class="line">&#125;</span><br><span class="line">```     </span><br><span class="line">	    </span><br><span class="line">正常的快速排序.</span><br><span class="line"></span><br><span class="line">默认的排序说完了,该说说这个了:</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line">	(<span class="type">Iterator</span>.<span class="type">Element</span>, <span class="type">Iterator</span>.<span class="type">Element</span>) -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure>
<p>这个闭包的执行是在快速排序,插入排序,堆排序中进行使用的,目的就是判断是升序,还是降序的.</p>
<p>我们就拿快速排序讲解吧(其实很简单):</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> !areInIncreasingOrder(elements[lo], pivot) &#123; <span class="keyword">break</span> <span class="type">FindLo</span> &#125;</span><br></pre></td></tr></table></figure>
<p>在之前的判断中是这样的:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">if</span> !(elements[lo] &lt; pivot) &#123; <span class="keyword">break</span> <span class="type">FindLo</span> &#125;</span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line">直接就是小于,而这个闭包其实也就是判断两个数大小的然后返回<span class="type">Bool</span>值,这样就可以控制升序降序了.</span><br><span class="line"></span><br><span class="line">## 补充:</span><br><span class="line">#### 在<span class="type">Swift</span>源码中我发现这样几句话:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">`<span class="type">The</span> sorting algorithm <span class="keyword">is</span> not stable. <span class="type">A</span> nonstable <span class="built_in">sort</span> may change the relative order of elements <span class="keyword">for</span> which `areInIncreasingOrder` does not establish an order.(排序算法是一个不稳定的算法,不稳定是相对于提供的areInIncreasingOrder闭包)`</span><br><span class="line"></span><br><span class="line">我们在使用<span class="built_in">sort</span>函数的时候都是**<span class="built_in">sort</span>(&lt;) **或者** <span class="built_in">sort</span>(&gt;) **,而不是用** <span class="built_in">sort</span>(&lt;=) **和** <span class="built_in">sort</span>(&gt;=) **</span><br><span class="line">原因:</span><br><span class="line"></span><br><span class="line">![](http:<span class="comment">//o9omj1fgd.bkt.clouddn.com/blog/swift_source_sode_analysis_sort/images/sort_reason.png)</span></span><br><span class="line"></span><br><span class="line">可以看出结果都是一样,但是运行的效率是不一样的.</span><br><span class="line"></span><br><span class="line">![](http:<span class="comment">//o9omj1fgd.bkt.clouddn.com/blog/swift_source_sode_analysis_sort/images/sort_result.png)</span></span><br><span class="line"></span><br><span class="line">同样的数组,同样的结果,却不同的执行次数.所以在写代码的时候要注意了,**千万不要加=号**</span><br><span class="line"></span><br><span class="line">#### 关于限制深度的问题</span><br><span class="line"></span><br><span class="line">(在<span class="number">2000</span>年<span class="number">6</span>月，<span class="type">SGI</span>的<span class="type">C</span>++标准模板库的stl_algo.h中的不稳定排序算法采用了<span class="type">Musser</span>的introsort算法。在此实现中，切换到插入排序的数据量阀值为<span class="number">16</span>个)</span><br><span class="line"></span><br><span class="line">```swift</span><br><span class="line"><span class="comment">// Insertion sort is better at handling smaller regions.</span></span><br><span class="line"> <span class="keyword">if</span> elements.<span class="built_in">distance</span>(from: range.lowerBound, to: range.upperBound) &lt; <span class="number">20</span> &#123;</span><br><span class="line">    _insertionSort(</span><br><span class="line">      &amp;elements,</span><br><span class="line">      subRange: range</span><br><span class="line">      )</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>说明在数量小于20的情况下采用插入排序,所以在Swift中阀值应该是20</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> depthLimit == <span class="number">0</span> &#123;</span><br><span class="line">    _heapSort(</span><br><span class="line">      &amp;elements,</span><br><span class="line">      subRange: range</span><br><span class="line">      )</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>在深度限制为0的时候采用堆排序,说明平衡已经被破坏,数据依旧很大,但是快速排序的效率低下,改用堆排序来维持O(logN)的时间复杂度</p>

      
      
        <div class="page-reward">
          <p><a href="javascript:void(0)" onclick="dashangToggle()" class="dashang">赏</a></p>
          <div class="hide_box"></div>
          <div class="shang_box">
            <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
            <div class="shang_tit">
              <p>谢谢打赏</p>
            </div>
            <div class="shang_payimg">
              <img src="/img/alipayimg.jpg" alt="扫码支持" title="扫一扫" />
            </div>
              <div class="pay_explain">扫码打赏，你说多少就多少</div>
            <div class="shang_payselect">
              
                <div class="pay_item checked" data-id="alipay">
                  <span class="radiobox"></span>
                  <span class="pay_logo"><img src="/img/alipay.png" alt="支付宝" /></span>
                </div>
              
              
                <div class="pay_item" data-id="wechat">
                  <span class="radiobox"></span>
                  <span class="pay_logo"><img src="/img/weixin.png" alt="微信" /></span>
                </div>
              
            </div>
            <div class="shang_info">
              <p>打开<span id="shang_pay_txt">支付宝</span>扫一扫，即可进行扫码打赏哦</p>
            </div>
          </div>
        </div>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
        <script type="text/javascript">
          $(".pay_item").click(function(){
            $(this).addClass('checked').siblings('.pay_item').removeClass('checked');
            var dataid=$(this).attr('data-id');
            $(".shang_payimg img").attr("src","/img/"+dataid+"img.jpg");
            $("#shang_pay_txt").text(dataid=="alipay"?"支付宝":"微信");
          });
          function dashangToggle(){

            $(".hide_box").fadeToggle();
            $(".shang_box").fadeToggle();
          }
        </script>
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>Title:</span><a href="/2016/06/05/Swift-Source-Code-Analysis-Sort/">Swift Source Code Analysis - Sort</a></p>
        <p><span>Author:</span><a href="/" title="访问 Mini灬哆啦 的个人博客">Mini灬哆啦</a></p>
        <p><span>Publish Time:</span>2016-06-05 00:00</p>
        <p><span>Update Time:</span>2018-01-15 21:13</p>
        <p>
            <span>Original Link:</span><a class="post-url" href="/2016/06/05/Swift-Source-Code-Analysis-Sort/" title="Swift Source Code Analysis - Sort">http://xwjack.github.io/2016/06/05/Swift-Source-Code-Analysis-Sort/</a>
            <span class="copy-path" data-clipboard-text="原文: http://xwjack.github.io/2016/06/05/Swift-Source-Code-Analysis-Sort/　　作者: Mini灬哆啦" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>License:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



<nav id="article-nav">
  
    <a href="/2016/07/19/Swift-Source-Code-Analysis-Array/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          Swift Source Code Analysis - Array
        
      </div>
    </a>
  
  
</nav>


  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Swift源码分析-Sort"><span class="toc-number">1.</span> <span class="toc-text">Swift源码分析 - Sort</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IntroSort-内省算法"><span class="toc-number">1.1.</span> <span class="toc-text">IntroSort(内省算法)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#将sort-swift-gyb文件转换成sort-swift文件"><span class="toc-number">1.1.1.</span> <span class="toc-text">将sort.swift.gyb文件转换成sort.swift文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Analysis"><span class="toc-number">1.1.2.</span> <span class="toc-text">Analysis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sort-CollectionAlgorithms-swift"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">sort - CollectionAlgorithms.swift</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#introSort-Sort-swift"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">_introSort - Sort.swift</span></a></li></ol></li></ol></li></ol></li></ol>
</div>
<input type="button" id="tocButton" value="隐藏目录"  title="Display or Hide">

<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }
    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
        }
    })
    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
    }
</script>






<div class="bdsharebuttonbox">
	<a href="#" class="fx fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="fx fa-weixin bds_weixin" data-cmd="weixin" title="分享到微信"></a>
	<a href="#" class="fx fa-qq bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
	<a href="#" class="fx fa-facebook-official bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
	<a href="#" class="fx fa-twitter bds_twi" data-cmd="twi" title="分享到Twitter"></a>
	<a href="#" class="fx fa-linkedin bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
	<a href="#" class="fx fa-files-o bds_copy" data-cmd="copy" title="分享到复制网址"></a>
</div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>




    
        <div id="gitments"></div>
<script src="/js/gitment.browser.js"></script>
<script>
    var gitment = new Gitment({
      id: window.location.pathname,
      owner: 'XWJACK',
      repo: 'xwjack.github.io',
      oauth: {
        client_id: '63a97a6fabe1ee5265d1',
        client_secret: 'b1fe01f8c1aed22c0e78e5b65ac4793bb1433707',
      },
    })
    gitment.render('gitments')
</script>
    



    <div class="scroll" id="post-nav-button">
        
            <a href="/2016/07/19/Swift-Source-Code-Analysis-Array/" title="上一篇: Swift Source Code Analysis - Array">
                <i class="fa fa-angle-left"></i>
            </a>
        
        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
        
            <a href="/" title="回到主页"><i class="fa fa-home"></i></a>
        
    </div>
    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/07/26/BTC/">BTC</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/17/iOSDesignPattern/">iOS Design Pattern</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/07/EffectiveObjectiveC20/">Effective Objective-C 2.0</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/27/NewYearGoal/">2018年目标</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/02/LLDB/">LLDB</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/22/Terminal/">Terminal</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/18/VideoToolbox/">VideoToolbox</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/10/Camera/">Camera</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/10/LivePhoto/">Live Photo</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/08/Marco/">Marco</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/28/iOS/">iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/21/XCTest/">XCTest</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/15/Reverse/">Reverse</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/25/GPUImage/">GPUImage</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/20/Framework/">Framework</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/31/Playback/">Playback</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/02/Lotus/">Lotus</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/24/Purchase/">iOS In-App Purchase</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/20/Music/">Music</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/16/Regex/">Regex</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/09/Build/">Build</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/06/Git/">Git</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/19/Swift-Source-Code-Analysis-Array/">Swift Source Code Analysis - Array</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/05/Swift-Source-Code-Analysis-Sort/">Swift Source Code Analysis - Sort</a></li></ul>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
            }
        })
    </script>



    <script>
        
    </script>

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2018 Mini灬哆啦
            </div>
            <div class="footer-right">
                <!-- <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman -->
            </div>
        </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 1;
            var backgroundimg = "url(/background/bg-" + backgroundnum +".png)";
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-80240532-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



	<!-- Baidu Analytics -->
	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?4312600141d9e3d6b344aba925f03a57";
	  var s = document.getElementsByTagName("script")[0];
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>
	<!-- End Baidu Analytics -->



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>