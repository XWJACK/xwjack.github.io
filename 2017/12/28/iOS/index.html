<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="default">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">






  
  
    
      
    
    
      
    
  <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
  <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-flash.min.css" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/head.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png?v=6.3.0">


  <link rel="mask-icon" href="/images/head.png?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="iOS 开发学习，各种记录。 很多东西都比较简单，但是很多东西都容易忘记，或者自己曾经遇到过但是忘记了当时是如何处理的，使得再次遇到依旧会浪费很多时间，所以不管难易，都记录下来，避免二次伤害。">
<meta name="keywords" content="iOS,Objective-C,Swift 3.2.0">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS">
<meta property="og:url" content="http://xwjack.github.io/2017/12/28/iOS/index.html">
<meta property="og:site_name" content="Mini灬哆啦">
<meta property="og:description" content="iOS 开发学习，各种记录。 很多东西都比较简单，但是很多东西都容易忘记，或者自己曾经遇到过但是忘记了当时是如何处理的，使得再次遇到依旧会浪费很多时间，所以不管难易，都记录下来，避免二次伤害。">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://xwjack.github.io/images/2017-12-28-iOS/1.png">
<meta property="og:image" content="http://xwjack.github.io/images/2017-12-28-iOS/6.png">
<meta property="og:image" content="http://xwjack.github.io/images/2017-12-28-iOS/4.png">
<meta property="og:image" content="http://xwjack.github.io/images/2017-12-28-iOS/3.png">
<meta property="og:image" content="http://xwjack.github.io/images/2017-12-28-iOS/2.png">
<meta property="og:updated_time" content="2018-11-29T10:08:51.350Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS">
<meta name="twitter:description" content="iOS 开发学习，各种记录。 很多东西都比较简单，但是很多东西都容易忘记，或者自己曾经遇到过但是忘记了当时是如何处理的，使得再次遇到依旧会浪费很多时间，所以不管难易，都记录下来，避免二次伤害。">
<meta name="twitter:image" content="http://xwjack.github.io/images/2017-12-28-iOS/1.png">






  <link rel="canonical" href="http://xwjack.github.io/2017/12/28/iOS/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>iOS | Mini灬哆啦</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-80240532-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-80240532-1');
</script>



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4312600141d9e3d6b344aba925f03a57";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Mini灬哆啦</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://xwjack.github.io/2017/12/28/iOS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mini灬哆啦">
      <meta itemprop="description" content="It's only a matter of time">
      <meta itemprop="image" content="/images/head.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Mini灬哆啦">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">iOS
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-12-28 00:00:00" itemprop="dateCreated datePublished" datetime="2017-12-28T00:00:00+08:00">2017-12-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-11-29 18:08:51" itemprop="dateModified" datetime="2018-11-29T18:08:51+08:00">2018-11-29</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/28/iOS/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">Comments: </span> <span class="post-comments-count gitment-comments-count" data-xid="/2017/12/28/iOS/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon"
            >
            <i class="fa fa-eye"></i>
             Views:  
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>iOS 开发学习，各种记录。</p>
<p>很多东西都比较简单，但是很多东西都容易忘记，或者自己曾经遇到过但是忘记了当时是如何处理的，使得再次遇到依旧会浪费很多时间，所以不管难易，都记录下来，避免二次伤害。</p>
<a id="more"></a>
<h1 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h1><p><img src="/images/2017-12-28-iOS/1.png" alt=""></p>
<p>整个流程：</p>
<ol>
<li>在你的 Mac 开发机器生成一对公私钥，这里称为公钥L，私钥L。L:Local</li>
<li>苹果自己有固定的一对公私钥，跟上面 AppStore 例子一样，私钥在苹果后台，公钥在每个 iOS 设备上。这里称为公钥A，私钥A。A:Apple</li>
<li>把公钥 L 传到苹果后台，用苹果后台里的私钥 A 去签名公钥 L。得到一份数据包含了公钥 L 以及其签名，把这份数据称为证书。</li>
<li>在苹果后台申请 AppID，配置好设备 ID 列表和 APP 可使用的权限，再加上第③步的证书，组成的数据用私钥 A 签名，把数据和签名一起组成一个 Provisioning Profile 文件，下载到本地 Mac 开发机。</li>
<li>在开发时，编译完一个 APP 后，用本地的私钥 L 对这个 APP 进行签名，同时把第④步得到的 Provisioning Profile 文件打包进 APP 里，文件名为 embedded.mobileprovision，把 APP 安装到手机上。</li>
<li>在安装时，iOS 系统取得证书，通过系统内置的公钥 A，去验证 embedded.mobileprovision 的数字签名是否正确，里面的证书签名也会再验一遍。</li>
<li>确保了 embedded.mobileprovision 里的数据都是苹果授权以后，就可以取出里面的数据，做各种验证，包括用公钥 L 验证APP签名，验证设备 ID 是否在 ID 列表上，AppID 是否对应得上，权限开关是否跟 APP 里的 Entitlements 对应等。</li>
</ol>
<p>上面的步骤对应到我们平常具体的操作和概念是这样的：</p>
<ol>
<li>第 1 步对应的是 keychain 里的 “从证书颁发机构请求证书”，这里就本地生成了一对公私钥，保存的 CertificateSigningRequest 就是公钥，私钥保存在本地电脑里。</li>
<li>第 2 步苹果处理，不用管。</li>
<li>第 3 步对应把 CertificateSigningRequest 传到苹果后台生成证书，并下载到本地。这时本地有两个证书，一个是第 1 步生成的，一个是这里下载回来的，keychain 会把这两个证书关联起来，因为他们公私钥是对应的，在XCode选择下载回来的证书时，实际上会找到 keychain 里对应的私钥去签名。这里私钥只有生成它的这台 Mac 有，如果别的 Mac 也要编译签名这个 App 怎么办？答案是把私钥导出给其他 Mac 用，在 keychain 里导出私钥，就会存成 .p12 文件，其他 Mac 打开后就导入了这个私钥。</li>
<li>第 4 步都是在苹果网站上操作，配置 AppID / 权限 / 设备等，最后下载 Provisioning Profile 文件。</li>
<li>第 5 步 XCode 会通过第 3 步下载回来的证书（存着公钥），在本地找到对应的私钥（第一步生成的），用本地私钥去签名 App，并把 Provisioning Profile 文件命名为 embedded.mobileprovision 一起打包进去。这里对 App 的签名数据保存分两部分，Mach-O 可执行文件会把签名直接写入这个文件里，其他资源文件则会保存在_CodeSignature目录下。</li>
</ol>
<p>概念：</p>
<ol>
<li>证书：内容是公钥或私钥，由其他机构对其签名组成的数据包。</li>
<li>Entitlements：包含了 App 权限开关列表。</li>
<li>CertificateSigningRequest：本地公钥。</li>
<li>p12：本地私钥，可以导入到其他电脑。</li>
<li>Provisioning Profile：包含了 证书 / Entitlements 等数据，并由苹果后台私钥签名的数据包。</li>
</ol>
<blockquote>
<p>引用 <a href="http://blog.cnbang.net/tech/3386/" target="_blank" rel="noopener">iOS App 签名的原理</a></p>
</blockquote>
<h1 id="Device"><a href="#Device" class="headerlink" title="Device"></a>Device</h1><p><a href="http://www.blakespot.com/ios_device_specifications_grid.html" target="_blank" rel="noopener">http://www.blakespot.com/ios_device_specifications_grid.html</a></p>
<iframe src="http://www.blakespot.com/ios_device_specifications_grid.html" width="100%" height="500" frameborder="0" scrolling="yes"></iframe>

<h1 id="UIKit"><a href="#UIKit" class="headerlink" title="UIKit"></a>UIKit</h1><h2 id="UIWindow"><a href="#UIWindow" class="headerlink" title="UIWindow"></a>UIWindow</h2><p>backgroundColor如果不设置或者为透明色，则不响应不透明事件。</p>
<h2 id="UIView"><a href="#UIView" class="headerlink" title="UIView"></a>UIView</h2><h3 id="Touch-Events"><a href="#Touch-Events" class="headerlink" title="Touch Events"></a>Touch Events</h3><p><img src="/images/2017-12-28-iOS/6.png" alt=""></p>
<p>1.系统将触摸事件打包成<code>UIEvent</code>对象<br>2.<code>UIApplication</code>将事件传递给<code>UIWindow</code><br>3.<code>UIWindow</code>调用<code>hitTest</code>方法。</p>
<h4 id="point-inside-with"><a href="#point-inside-with" class="headerlink" title="point(inside:with:)"></a>point(inside:with:)</h4><p>Returns a Boolean value indicating whether the receiver contains the specified point.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">point</span><span class="params">(inside point: CGPoint, with event: UIEvent?)</span></span> -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure>
<p>判断触摸的点在不在该试图范围内。</p>
<h4 id="hitTest-with"><a href="#hitTest-with" class="headerlink" title="hitTest(_:with:)"></a>hitTest(_:with:)</h4><p>Returns the farthest descendant of the receiver in the view hierarchy (including itself) that contains a specified point.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hitTest</span><span class="params">(<span class="number">_</span> point: CGPoint, with event: UIEvent?)</span></span> -&gt; <span class="type">UIView</span>?</span><br></pre></td></tr></table></figure>
<p>判断哪个视图响应事件</p>
<p>调用当前视图的<code>func point(inside point: CGPoint, with event: UIEvent?) -&gt; Bool</code>判断触摸点是否在当前视图内。</p>
<p><code>false</code>：直接返回<code>nil</code>，表示触摸点不在当前视图；</p>
<p><code>true</code>：遍历并调用当前视图的子视图<code>hitTest</code>方法。如果所有的子视图<code>hitTest</code>都返回<code>nil</code>，则返回自身；如果有子视图返回不为空，则返回该子视图。</p>
<blockquote>
<p>遍历是从当前视图的最顶层视图遍历到最底层视图，即从<code>subviews</code>最后一个开始向前遍历。</p>
<p>如果<code>isHidden</code>为<code>true</code>，<code>alpha</code>为<code>0</code>，子视图超过父视图范围，则该视图的<code>hitTest</code>返回<code>nil</code>。</p>
<p>当设置视图的<code>backgroundColor</code>为<code>clearColor</code>的时候，虽然当前视图也是透明的，但是依旧将事件向子视图传递。</p>
</blockquote>
<h3 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 在一次开发中，当同时改变视图的位置和大小的时候，动画会出现异常。</span></span><br><span class="line"><span class="comment">/// 我希望的动画是以center为中心，改变view的大小，结果动画会先向左上角闪一下，再回到center的位置。</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.3</span> animations:^&#123;</span><br><span class="line">    view.center = &lt;<span class="meta"># CGPoint #&gt;;</span></span><br><span class="line">    view.frame = &lt;<span class="meta"># CGRect #&gt;</span></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 解决方法</span></span><br><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.3</span> animations:^&#123;</span><br><span class="line">    view.center = &lt;<span class="meta"># CGPoint #&gt;;</span></span><br><span class="line">    view.transform = <span class="built_in">CGAffineTransformMakeScale</span>(<span class="number">0.5</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当frame改变的时候transform会重设。</p>
</blockquote>
<h2 id="UIScrollView"><a href="#UIScrollView" class="headerlink" title="UIScrollView"></a>UIScrollView</h2><h2 id="UITableView"><a href="#UITableView" class="headerlink" title="UITableView"></a>UITableView</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.tableView = [[<span class="built_in">UITableView</span> alloc] initWithFrame:<span class="built_in">CGRectZero</span> style:<span class="built_in">UITableViewStyleGrouped</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 配套使用</span></span><br><span class="line">- (<span class="built_in">UIView</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView viewForHeaderInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">- (<span class="built_in">CGFloat</span>)tableView:(<span class="built_in">UITableView</span> *)tableView heightForHeaderInSection:(<span class="built_in">NSInteger</span>)section</span><br></pre></td></tr></table></figure>
<h3 id="reloadData"><a href="#reloadData" class="headerlink" title="reloadData"></a>reloadData</h3><h4 id="How-to-keep-UITableView-contentOffset-after-calling-reloadData"><a href="#How-to-keep-UITableView-contentOffset-after-calling-reloadData" class="headerlink" title="How to keep UITableView contentOffset after calling reloadData"></a>How to keep UITableView <code>contentOffset</code> after calling <code>reloadData</code></h4><p><a href="https://stackoverflow.com/questions/8640409/how-to-keep-uitableview-contentoffset-after-calling-reloaddata" target="_blank" rel="noopener">How to keep UITableView contentoffset after calling -reloadData</a></p>
<p><code>reloadData</code>并不会调整<code>offset</code></p>
<blockquote>
<p>仅仅在Cell的高度为固定的状态，如果Cell是动态计算出来的就不一定了。如果Cell的高度是不固定的，那么他的<code>contentOffset</code>也是不固定的，而是在滑动的过程中不断的计算出来。</p>
</blockquote>
<p>具体的解决方式没有尝试过，别人提出的方式是用字典来缓存高度。</p>
<h3 id="MJRefresh"><a href="#MJRefresh" class="headerlink" title="MJRefresh"></a>MJRefresh</h3><h4 id="解决下拉刷新无法回弹的问题"><a href="#解决下拉刷新无法回弹的问题" class="headerlink" title="解决下拉刷新无法回弹的问题"></a>解决下拉刷新无法回弹的问题</h4><p><a href="https://github.com/CoderMJLee/MJRefresh/issues/956" target="_blank" rel="noopener">关于iOS11 上下拉刷新无法返回的问题，不关MJRefresh的事，解答</a></p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Detail</th>
<th>Available</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>automaticallyAdjustsScrollViewInsets</code></td>
<td>自动调节<code>UIScrollView</code>的<code>contentInset</code></td>
<td>iOS 7.0 ~ 11.0</td>
</tr>
<tr>
<td><code>contentInsetAdjustmentBehavior</code></td>
<td>自动调节<code>UIScrollView</code>的<code>contentInset</code></td>
<td>iOS 11.0+</td>
</tr>
</tbody>
</table>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 关闭自动调节</span></span><br><span class="line"><span class="keyword">if</span> (@available(iOS <span class="number">11.0</span>, *)) &#123;</span><br><span class="line">    <span class="keyword">self</span>.tableView.contentInsetAdjustmentBehavior = <span class="built_in">UIScrollViewContentInsetAdjustmentNever</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">self</span>.automaticallyAdjustsScrollViewInsets = <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 如果有导航栏设置偏移量。</span></span><br><span class="line"><span class="keyword">self</span>.tableView.contentInset = <span class="built_in">UIEdgeInsetsMake</span>(&lt;<span class="meta">#CGFloat TopBarHeight#&gt;, 0, 0, 0);</span></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">[<span class="keyword">self</span>.tableView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">    make.top.equalTo(<span class="keyword">self</span>.view).offset(&lt;<span class="meta">#CGFloat TopBarHeight#&gt;);</span></span><br><span class="line">    make.left.bottom.right.equalTo(<span class="keyword">self</span>.view);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 设置Cell的高度。</span></span><br><span class="line"><span class="keyword">self</span>.tableView.estimatedRowHeight = &lt;<span class="meta">#CGFloat CellHeight#&gt;;</span></span><br><span class="line"><span class="keyword">self</span>.tableView.rowHeight = <span class="built_in">UITableViewAutomaticDimension</span>;</span><br></pre></td></tr></table></figure>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><h4 id="一个TableView中多种样式相似的Cell"><a href="#一个TableView中多种样式相似的Cell" class="headerlink" title="一个TableView中多种样式相似的Cell"></a>一个TableView中多种样式相似的Cell</h4><p>当一个UITableView中有多种Cell，但是又差不多样式，最优雅的方式是使用继承方式来实现，不要用if、else来判断哪个Cell显示哪些内容。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 通用样式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BaseSampleTableViewCell</span> : <span class="title">UITableViewCell</span></span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *avatarImageView;</span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *titleLabel;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 一个按钮的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">OneButtonSampleTableViewCell</span>: <span class="title">BaseSampleTableViewCell</span></span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *buttonOne;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 两个按钮的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TwoButtonSampleTableViewCell</span>: <span class="title">OneButtonSampleTableViewCell</span></span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIButton</span> *buttonTwo;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 两个按钮带输入框的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TextViewSampleTableViewCell</span>: <span class="title">TwoButtonSampleTableViewCell</span></span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UITextView</span> *textView;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果点击按钮Cell的样式改变直接<code>[tableView dequeueReusableCellWithIdentifier:[TwoButtonSampleTableViewCell reuseIdentifier] forIndexPath:indexPath];</code>对应样式的Cell就OK了，避免过多的if、else。</p>
</blockquote>
<h5 id="动态显示"><a href="#动态显示" class="headerlink" title="动态显示"></a>动态显示</h5><p>很多时候我们需要根据服务器返回的是否为空来动态显示内容，这个时候依旧用继承重写进行实现，在动态将相应的视图添加到父视图上，并修改约束。</p>
<h4 id="优雅的唯一表示一个Cell"><a href="#优雅的唯一表示一个Cell" class="headerlink" title="优雅的唯一表示一个Cell"></a>优雅的唯一表示一个Cell</h4><p>很多人在注册Cell的时候会写很多的字符串来注册，建议采用下面方式来进行。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UITableViewCell</span> (<span class="title">ReuseIdentifier</span>)</span></span><br><span class="line">+ (<span class="built_in">NSString</span> *)reuseIdentifier;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UITableViewCell</span> (<span class="title">ReuseIdentifier</span>)</span></span><br><span class="line">+ (<span class="built_in">NSString</span> *)reuseIdentifier &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> description];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MARK: - Identifier</span></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">ReuseIdentifier</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">ReuseIdentifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> reuseIdentifier: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="type">String</span>(describing: type(of: <span class="keyword">self</span>)) &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> reuseIdentifier: <span class="type">String</span> &#123; <span class="keyword">return</span> <span class="type">String</span>(describing: <span class="keyword">self</span>) &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// Add reuseIdentifier into UITableViewCell, it also can been using any object to get class name.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// Uniquely an UITableViewCell by class name.</span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// ABCUITableViewCell.reuseIdentifier // "ABCUITableViewCell"</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UITableViewCell</span>: <span class="title">ReuseIdentifier</span> </span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UICollectionViewCell</span>: <span class="title">ReuseIdentifier</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>是不是优雅了很多呢？</p>
</blockquote>
<h2 id="UICollectionView"><a href="#UICollectionView" class="headerlink" title="UICollectionView"></a>UICollectionView</h2><h3 id="Horizontal-refresh"><a href="#Horizontal-refresh" class="headerlink" title="Horizontal refresh"></a>Horizontal refresh</h3><p>仿照MJRefresh的结构来写的，至此也大致了解了MJRefresh的设计模式。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pragma mark - Horizontal Refresh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">void</span> (^RefreshBlock)(<span class="keyword">void</span>);</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> RefreshKeyPathContentOffset = <span class="string">@"contentOffset"</span>;</span><br><span class="line"><span class="comment">//static NSString *const RefreshKeyPathContentInset = @"contentInset";</span></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> RefreshKeyPathContentSize = <span class="string">@"contentSize"</span>;</span><br><span class="line"><span class="comment">/** 刷新控件的状态 */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, RefreshState) &#123;</span><br><span class="line">    <span class="comment">/** 普通闲置状态 */</span></span><br><span class="line">    RefreshStateNormal = <span class="number">1</span>,</span><br><span class="line">    <span class="comment">/** 松开就可以进行刷新的状态 */</span></span><br><span class="line">    RefreshStatePulling,</span><br><span class="line">    <span class="comment">/** 正在刷新中的状态 */</span></span><br><span class="line">    RefreshStateRefreshing,</span><br><span class="line">    <span class="comment">/** 即将刷新的状态 */</span></span><br><span class="line">    RefreshStateWillRefresh,</span><br><span class="line">    <span class="comment">/** 所有数据加载完毕，没有更多的数据了 */</span></span><br><span class="line">    RefreshStateNoMoreData</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BaseHorizontalRefresh</span>: <span class="title">UIView</span></span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">UIScrollView</span> *scrollView;</span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) RefreshBlock refreshBlock;</span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) RefreshState state;</span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UIEdgeInsets</span> refreshingInset;<span class="comment">/// 刷新状态的Inset</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">BOOL</span> isCanRefresh;<span class="comment">/// 是否到达可以刷新的点</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">BOOL</span> isRefreshing;<span class="comment">/// 是否正在刷新</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">UIEdgeInsets</span> originInsets;<span class="comment">/// 原始inset</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">CGRect</span> defaultFrame;<span class="comment">///初始化大小</span></span><br><span class="line">- (<span class="keyword">void</span>)beginRefreshing;</span><br><span class="line">- (<span class="keyword">void</span>)endRefreshing;</span><br><span class="line">- (<span class="keyword">void</span>)scrollViewContentOffsetDidChange:(<span class="built_in">NSDictionary</span> *)change;</span><br><span class="line">- (<span class="keyword">void</span>)scrollViewContentSizeDidChange:(<span class="built_in">NSDictionary</span> *)chang;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BaseHorizontalRefresh</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.state = RefreshStateNormal;</span><br><span class="line">        <span class="keyword">self</span>.autoresizingMask = <span class="built_in">UIViewAutoresizingFlexibleHeight</span>;</span><br><span class="line">        <span class="keyword">self</span>.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)willMoveToSuperview:(<span class="built_in">UIView</span> *)newSuperview &#123;</span><br><span class="line">    [<span class="keyword">super</span> willMoveToSuperview:newSuperview];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.originInsets = <span class="keyword">self</span>.scrollView.contentInset;</span><br><span class="line">    <span class="comment">/// 设置初始大小</span></span><br><span class="line">    <span class="keyword">self</span>.frame = <span class="keyword">self</span>.defaultFrame;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> removeObservers];</span><br><span class="line">    [<span class="keyword">self</span> addObservers];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)addObservers &#123;</span><br><span class="line">    <span class="built_in">NSKeyValueObservingOptions</span> options = <span class="built_in">NSKeyValueObservingOptionNew</span> | <span class="built_in">NSKeyValueObservingOptionOld</span>;</span><br><span class="line">    [<span class="keyword">self</span>.scrollView addObserver:<span class="keyword">self</span> forKeyPath:RefreshKeyPathContentOffset options:options context:<span class="literal">nil</span>];</span><br><span class="line">    [<span class="keyword">self</span>.scrollView addObserver:<span class="keyword">self</span> forKeyPath:RefreshKeyPathContentSize options:options context:<span class="literal">nil</span>];</span><br><span class="line">    <span class="comment">//    self.pan = self.scrollView.panGestureRecognizer;</span></span><br><span class="line">    <span class="comment">//    [self.pan addObserver:self forKeyPath:MJRefreshKeyPathPanState options:options context:nil];</span></span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)removeObservers &#123;</span><br><span class="line">    [<span class="keyword">self</span>.superview removeObserver:<span class="keyword">self</span> forKeyPath:RefreshKeyPathContentOffset];</span><br><span class="line">    [<span class="keyword">self</span>.superview removeObserver:<span class="keyword">self</span> forKeyPath:RefreshKeyPathContentSize];</span><br><span class="line">    <span class="comment">//    [self.pan removeObserver:self forKeyPath:MJRefreshKeyPathPanState];</span></span><br><span class="line">    <span class="comment">//    self.pan = nil;</span></span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span> *)change context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line">    <span class="comment">// 遇到这些情况就直接返回</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.userInteractionEnabled) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 这个就算看不见也需要处理</span></span><br><span class="line">    <span class="keyword">if</span> ([keyPath isEqualToString:RefreshKeyPathContentSize]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> scrollViewContentSizeDidChange:change];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 看不见</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.hidden) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> ([keyPath isEqualToString:RefreshKeyPathContentOffset]) &#123;</span><br><span class="line">        [<span class="keyword">self</span> scrollViewContentOffsetDidChange:change];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//    else if ([keyPath isEqualToString:RefreshKeyPathPanState]) &#123;</span></span><br><span class="line">    <span class="comment">//        [self scrollViewPanStateDidChange:change];</span></span><br><span class="line">    <span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">BOOL</span>)isRefreshing &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.state == RefreshStateRefreshing;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma Subclass Override Begin</span></span><br><span class="line">- (<span class="built_in">UIEdgeInsets</span>)refreshingInset &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">UIEdgeInsetsZero</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">BOOL</span>)isCanRefresh &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma Subclass Override Begin</span></span><br><span class="line">- (<span class="keyword">void</span>)beginRefreshing &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.isRefreshing)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.state = RefreshStateRefreshing;</span><br><span class="line">    __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) wself = <span class="keyword">self</span>;</span><br><span class="line">    [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.25</span> animations:^&#123;</span><br><span class="line">        wself.scrollView.contentInset = <span class="keyword">self</span>.refreshingInset;</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.refreshBlock)</span><br><span class="line">        <span class="keyword">self</span>.refreshBlock();</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)endRefreshing &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.isRefreshing)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.state = RefreshStateNormal;</span><br><span class="line">    __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) wself = <span class="keyword">self</span>;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:<span class="number">0.4</span> animations:^&#123;</span><br><span class="line">            wself.scrollView.contentInset = wself.originInsets;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)scrollViewContentOffsetDidChange:(<span class="built_in">NSDictionary</span> *)change &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.state == RefreshStateRefreshing) &#123;</span><br><span class="line">        <span class="keyword">self</span>.scrollView.contentInset = <span class="keyword">self</span>.refreshingInset;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.scrollView.isDragging) &#123;</span><br><span class="line">        <span class="keyword">self</span>.state = <span class="keyword">self</span>.isCanRefresh ? RefreshStatePulling : RefreshStateNormal;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span>.state == RefreshStatePulling) &#123;</span><br><span class="line">        [<span class="keyword">self</span> beginRefreshing];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)scrollViewContentSizeDidChange:(<span class="built_in">NSDictionary</span> *)change &#123;&#125;</span><br><span class="line"><span class="comment">//- (void)scrollViewPanStateDidChange:(NSDictionary *)change&#123;&#125;</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark Header</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HorizontalRefreshHeader</span>: <span class="title">BaseHorizontalRefresh</span></span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">UIActivityIndicatorView</span> *indicatorView;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)refreshWithRefreshBlock:(RefreshBlock)block;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HorizontalRefreshHeader</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.indicatorView = [[<span class="built_in">UIActivityIndicatorView</span> alloc] initWithActivityIndicatorStyle:<span class="built_in">UIActivityIndicatorViewStyleWhite</span>];</span><br><span class="line">        <span class="keyword">self</span>.indicatorView.hidesWhenStopped = <span class="literal">NO</span>;</span><br><span class="line">        <span class="keyword">self</span>.indicatorView.color = <span class="built_in">UIColor</span>.blackColor;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:<span class="keyword">self</span>.indicatorView];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)refreshWithRefreshBlock:(RefreshBlock)block &#123;</span><br><span class="line">    HorizontalRefreshHeader *header = [[HorizontalRefreshHeader alloc] init];</span><br><span class="line">    header.refreshBlock = block;</span><br><span class="line">    <span class="keyword">return</span> header;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews &#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    <span class="keyword">self</span>.indicatorView.center = <span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.bounds.size.width / <span class="number">2</span>, <span class="keyword">self</span>.bounds.size.height / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)beginRefreshing &#123;</span><br><span class="line">    [<span class="keyword">super</span> beginRefreshing];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.indicatorView.isAnimating) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.indicatorView startAnimating];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)endRefreshing &#123;</span><br><span class="line">    [<span class="keyword">super</span> endRefreshing];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.indicatorView.isAnimating) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.indicatorView stopAnimating];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGRect</span>)defaultFrame &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">CGRectMake</span>(<span class="number">-54</span>, <span class="number">0</span>, <span class="number">54</span>, <span class="keyword">self</span>.scrollView.bounds.size.height);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIEdgeInsets</span>)refreshingInset &#123;</span><br><span class="line">    <span class="built_in">UIEdgeInsets</span> inset = <span class="keyword">self</span>.scrollView.contentInset;</span><br><span class="line">    inset.left = <span class="number">54</span>;</span><br><span class="line">    <span class="keyword">return</span> inset;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">BOOL</span>)isCanRefresh &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.scrollView.contentOffset.x &lt;= <span class="number">-54</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)scrollViewContentOffsetDidChange:(<span class="built_in">NSDictionary</span> *)change &#123;</span><br><span class="line">    [<span class="keyword">super</span> scrollViewContentOffsetDidChange:change];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.isRefreshing &amp;&amp; <span class="keyword">self</span>.scrollView.isDragging &amp;&amp; <span class="keyword">self</span>.scrollView.contentOffset.x &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">CGFloat</span> percent = <span class="keyword">self</span>.scrollView.contentOffset.x / <span class="number">-54</span>;</span><br><span class="line">        <span class="keyword">if</span> (percent &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">            [<span class="keyword">self</span>.indicatorView startAnimating];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.indicatorView.transform = <span class="built_in">CGAffineTransformMakeScale</span>(percent, percent);</span><br><span class="line">            [<span class="keyword">self</span>.indicatorView stopAnimating];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark Footer</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">HorizontalRefreshFooter</span>: <span class="title">BaseHorizontalRefresh</span></span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) <span class="built_in">UIActivityIndicatorView</span> *indicatorView;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)refreshWithRefreshBlock:(RefreshBlock)block;</span><br><span class="line">- (<span class="keyword">void</span>)endRefreshingWithNoMoreData;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">HorizontalRefreshFooter</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.indicatorView = [[<span class="built_in">UIActivityIndicatorView</span> alloc] initWithActivityIndicatorStyle:<span class="built_in">UIActivityIndicatorViewStyleWhite</span>];</span><br><span class="line">        <span class="keyword">self</span>.indicatorView.hidesWhenStopped = <span class="literal">NO</span>;</span><br><span class="line">        <span class="keyword">self</span>.indicatorView.color = <span class="built_in">UIColor</span>.blackColor;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:<span class="keyword">self</span>.indicatorView];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)refreshWithRefreshBlock:(RefreshBlock)block &#123;</span><br><span class="line">    HorizontalRefreshFooter *footer = [[HorizontalRefreshFooter alloc] init];</span><br><span class="line">    footer.refreshBlock = block;</span><br><span class="line">    <span class="keyword">return</span> footer;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews &#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    <span class="keyword">self</span>.indicatorView.center = <span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.bounds.size.width / <span class="number">2</span>, <span class="keyword">self</span>.bounds.size.height / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)beginRefreshing &#123;</span><br><span class="line">    [<span class="keyword">super</span> beginRefreshing];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.indicatorView.isAnimating) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.indicatorView startAnimating];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)endRefreshing &#123;</span><br><span class="line">    [<span class="keyword">super</span> endRefreshing];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.indicatorView.isAnimating) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.indicatorView stopAnimating];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.indicatorView.hidden = <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)endRefreshingWithNoMoreData &#123;</span><br><span class="line">    [<span class="keyword">self</span> endRefreshing];</span><br><span class="line">    <span class="keyword">self</span>.state = RefreshStateNoMoreData;</span><br><span class="line">    <span class="keyword">self</span>.indicatorView.hidden = <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">CGRect</span>)defaultFrame &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.scrollView.bounds.size.width, <span class="number">0</span>, <span class="number">44</span>, <span class="keyword">self</span>.scrollView.bounds.size.height);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIEdgeInsets</span>)refreshingInset &#123;</span><br><span class="line">    <span class="built_in">UIEdgeInsets</span> inset = <span class="keyword">self</span>.scrollView.contentInset;</span><br><span class="line">    inset.right = <span class="number">44</span>;</span><br><span class="line">    <span class="keyword">return</span> inset;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">BOOL</span>)isCanRefresh &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.state == RefreshStateNoMoreData ? <span class="literal">NO</span> : <span class="keyword">self</span>.scrollView.contentOffset.x + <span class="keyword">self</span>.scrollView.bounds.size.width - <span class="keyword">self</span>.offsetRevise.x &gt;= <span class="number">44</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// 当数据量特别小的时候修正offset</span></span><br><span class="line">- (<span class="built_in">CGPoint</span>)offsetRevise &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">CGPointMake</span>(MAX(<span class="keyword">self</span>.scrollView.contentSize.width, <span class="keyword">self</span>.scrollView.bounds.size.width), <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)scrollViewContentOffsetDidChange:(<span class="built_in">NSDictionary</span> *)change &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.state == RefreshStateRefreshing) &#123;</span><br><span class="line">        <span class="keyword">self</span>.scrollView.contentInset = <span class="keyword">self</span>.refreshingInset;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.state == RefreshStateNoMoreData)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.scrollView.isDragging) &#123;</span><br><span class="line">        <span class="keyword">self</span>.state = <span class="keyword">self</span>.isCanRefresh ? RefreshStatePulling : RefreshStateNormal;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span>.state == RefreshStatePulling) &#123;</span><br><span class="line">        [<span class="keyword">self</span> beginRefreshing];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.isRefreshing &amp;&amp; <span class="keyword">self</span>.scrollView.isDragging &amp;&amp; <span class="keyword">self</span>.scrollView.contentOffset.x + <span class="keyword">self</span>.scrollView.bounds.size.width &gt; <span class="keyword">self</span>.offsetRevise.x) &#123;</span><br><span class="line">        <span class="built_in">CGFloat</span> percent = (<span class="keyword">self</span>.scrollView.contentOffset.x + <span class="keyword">self</span>.scrollView.bounds.size.width - <span class="keyword">self</span>.offsetRevise.x) / <span class="number">44</span>;</span><br><span class="line">        <span class="keyword">if</span> (percent &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">            [<span class="keyword">self</span>.indicatorView startAnimating];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.indicatorView.transform = <span class="built_in">CGAffineTransformMakeScale</span>(percent, percent);</span><br><span class="line">            [<span class="keyword">self</span>.indicatorView stopAnimating];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)scrollViewContentSizeDidChange:(<span class="built_in">NSDictionary</span> *)chang &#123;</span><br><span class="line">    <span class="keyword">self</span>.frame = <span class="built_in">CGRectMake</span>(<span class="keyword">self</span>.offsetRevise.x, <span class="keyword">self</span>.frame.origin.y, <span class="number">44</span>, <span class="keyword">self</span>.frame.size.height);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark Carthage</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIScrollView</span> (<span class="title">HorizontalRefresh</span>)</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) HorizontalRefreshHeader *horizontal_header;</span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>) HorizontalRefreshFooter *horizontal_footer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIScrollView</span> (<span class="title">HorizontalRefresh</span>)</span></span><br><span class="line">- (<span class="keyword">void</span>)setHorizontal_header:(HorizontalRefreshHeader *)horizontal_header &#123;</span><br><span class="line">    <span class="keyword">if</span> (horizontal_header != <span class="keyword">self</span>.horizontal_header) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.horizontal_header removeFromSuperview];</span><br><span class="line">        </span><br><span class="line">        horizontal_header.scrollView = <span class="keyword">self</span>;</span><br><span class="line">        horizontal_header.tag = <span class="number">666</span>;</span><br><span class="line">        [<span class="keyword">self</span> insertSubview:horizontal_header atIndex:<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (HorizontalRefreshHeader *)horizontal_header &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> viewWithTag:<span class="number">666</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)setHorizontal_footer:(HorizontalRefreshFooter *)horizontal_footer &#123;</span><br><span class="line">    <span class="keyword">if</span> (horizontal_footer != <span class="keyword">self</span>.horizontal_footer) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.horizontal_footer removeFromSuperview];</span><br><span class="line">        </span><br><span class="line">        horizontal_footer.scrollView = <span class="keyword">self</span>;</span><br><span class="line">        horizontal_footer.tag = <span class="number">999</span>;</span><br><span class="line">        [<span class="keyword">self</span> insertSubview:horizontal_footer atIndex:<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (HorizontalRefreshFooter *)horizontal_footer &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> viewWithTag:<span class="number">999</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<ul>
<li>当调用同时调用reloadData和改变contentInset（回弹）的时候会出现抖动的问题，所以需要将改变contentInset放到下一个runloop中调用。</li>
</ul>
<h3 id="selected-muti-selected"><a href="#selected-muti-selected" class="headerlink" title="selected muti-selected"></a>selected muti-selected</h3><p>在这里我们使用UICollectionView来实现单选、多选，因为自带单选，我们只需要解决多选就可以了。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// UICollectionViewCell</span></span><br><span class="line">- (<span class="keyword">void</span>)setSelected:(<span class="built_in">BOOL</span>)selected &#123;</span><br><span class="line">    [<span class="keyword">super</span> setSelected:selected];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 修改选择样式。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// UICollectionView</span></span><br><span class="line"><span class="keyword">self</span>.allowsSelection = <span class="literal">YES</span>;</span><br><span class="line"><span class="keyword">self</span>.allowsMultipleSelection = <span class="literal">YES</span><span class="comment">/*单选改成NO*/</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// UICollectionViewDelegate</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)collectionView:(<span class="built_in">UICollectionView</span> *)collectionView shouldSelectItemAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.maxSelectableCount &gt; <span class="number">1</span> &amp;&amp; <span class="keyword">self</span>.indexPathsForSelectedItems.count &gt;= <span class="keyword">self</span>.maxSelectableCount) &#123;</span><br><span class="line">			<span class="comment">/// 多选且大于最大可选数量，则不继续选择。</span></span><br><span class="line">      	<span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="UICollectionViewFlowLayout"><a href="#UICollectionViewFlowLayout" class="headerlink" title="UICollectionViewFlowLayout"></a>UICollectionViewFlowLayout</h3><p>左对齐。</p>
<p><a href="https://github.com/mokagio/UICollectionViewLeftAlignedLayout" target="_blank" rel="noopener">UICollectionViewLeftAlignedLayout</a></p>
<h2 id="UITextView"><a href="#UITextView" class="headerlink" title="UITextView"></a>UITextView</h2><h3 id="UITextView-with-auto-size"><a href="#UITextView-with-auto-size" class="headerlink" title="UITextView with auto size."></a>UITextView with auto size.</h3><p>如何在UIScrollView或者其子类中使用UITextView并自动计算高度，自动改变UIScrollView的offset。诸如此类的文章很多，在此总结自己的想法。</p>
<ol>
<li>键盘谈起的时候判断是否遮挡UIScrollView中的UITextView，根据需要改变offset。</li>
<li>当UITextView换行的时候需要判断是否键盘是否再次挡住UITextView。</li>
</ol>
<ul>
<li>Setting</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 设置约束，从上到下约束都需要是满的。</span></span><br><span class="line">[<span class="keyword">self</span>.scrollView addSubview:<span class="keyword">self</span>.textView];</span><br><span class="line">[<span class="keyword">self</span>.textView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">    make.top.right.bottom.left.equalTo(<span class="keyword">self</span>);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">/// 关闭滚动。</span></span><br><span class="line">textView.scrollEnabled = <span class="literal">NO</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>Listening</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 监听键盘frame改变。</span></span><br><span class="line">[[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(keyBoardChangeFrame:) name:<span class="built_in">UIKeyboardWillChangeFrameNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)keyBoardChangeFrame:(<span class="built_in">NSNotification</span> *)notification &#123;</span><br><span class="line">    <span class="comment">//获取键盘弹出或收回时frame</span></span><br><span class="line">    <span class="built_in">CGRect</span> keyBoardFrame = [notification.userInfo[<span class="built_in">UIKeyboardFrameEndUserInfoKey</span>] <span class="built_in">CGRectValue</span>];</span><br><span class="line">    <span class="built_in">BOOL</span> isKeyboardHidden = keyBoardFrame.origin.y == <span class="keyword">self</span>.view.frame.size.height;</span><br><span class="line">    <span class="comment">/// 防止在输入的时候滑动</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.scrollEnabled = isKeyboardHidden;</span><br><span class="line">    <span class="comment">/// 计算键盘顶部到scrollView顶部的距离。</span></span><br><span class="line">    <span class="built_in">CGFloat</span> keyboardTopOffset = <span class="keyword">self</span>.scrollView.bounds.size.height - keyBoardFrame.size.height;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGPoint</span> newPoint = <span class="built_in">CGPointZero</span>;</span><br><span class="line">    <span class="keyword">if</span> (!isKeyboardHidden) &#123;</span><br><span class="line">        <span class="comment">/// 计算scrollView应该移动的距离。</span></span><br><span class="line">        <span class="built_in">CGFloat</span> moveOffset = &lt;<span class="meta">#scrollView中参考点的frame.y#&gt; - keyboardTopOffset;</span></span><br><span class="line">        <span class="keyword">if</span> (moveOffset &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            newPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, moveOffset);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">self</span>.scrollView setContentOffset:newPoint animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里的参考点可以是这个textView，在<code>- (void)textViewDidChange:(UITextView *)textView</code>中计算是否需要重新设置scrollView的contentOffset。</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGFloat</span> keyboardTopOffset = <span class="keyword">self</span>.scrollView.bounds.size.height - keyBoardFrame.size.height;</span><br><span class="line"><span class="comment">/// 判断是否需要移动</span></span><br><span class="line"><span class="built_in">CGFloat</span> isNeedAdjustOffset = &lt;<span class="meta">#scrollView中参考点的frame.y#&gt; - keyboardTopOffset;</span></span><br><span class="line"><span class="keyword">if</span> (isNeedAdjustOffset &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> moveOffset = isNeedAdjustOffset - <span class="keyword">self</span>.scrollView.contentOffset.y;</span><br><span class="line">    <span class="keyword">if</span> (moveOffset != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">CGPoint</span> newPoint = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, moveOffset + <span class="keyword">self</span>.scrollView.contentOffset.y);</span><br><span class="line">        [<span class="keyword">self</span>.scrollView setContentOffset:newPoint animated:<span class="literal">NO</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这样就会让指定的点关键点始终在键盘的上面。</p>
</blockquote>
<h3 id="Limit-number-of-character"><a href="#Limit-number-of-character" class="headerlink" title="Limit number of character"></a>Limit number of character</h3><p>字符限制在很多场景都会用到，但是除了普通的汉字和ABC之外还有表情其他字符，这个时候单判断字符是会出现以下问题的。</p>
<ol>
<li>表情这里比较坑，不同的表情占用的字符数量并不一定。有的占两个字符长度，有的占四个字符长度，有的占11个字符长度，所以单从(text.length)来限制，就会导致最少只能显示几个表情的问题。</li>
<li>如果检测是在输入的过程中，则会出现最后几个字还没有打出来，就直接截断，导致显示的是拼音。</li>
<li>复制粘贴也需要根据实际情况进行截断。</li>
<li>如果单从text.length来截取，可能会造成最后一个如果是表情，可能会出现错误符号。</li>
</ol>
<p>我个人的解决办法是将ASCII作为一个字符，非ASCII作为两个字符。或者将汉字作为两个字符，其他作为一个字符。这样就不会出现汉字可以很多，表情只能输入几个的问题了。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">extension</span> <span class="title">UITextInput</span> </span>&#123;</span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameters:</span></span><br><span class="line">  <span class="comment">///   - limit: 限制字符数量</span></span><br><span class="line">  <span class="comment">///   - cut: 超出部分是否截断</span></span><br><span class="line">  <span class="comment">/// - Returns: 是否超出限制</span></span><br><span class="line">  @discardableResult</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">isOutnumber</span><span class="params">(limit: Int, cut: Bool = <span class="literal">true</span>)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> isOutNumber = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> noneSelect = markedTextRange?.isEmpty ?? <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> limit != <span class="number">0</span> &amp;&amp; noneSelect,</span><br><span class="line">      <span class="keyword">let</span> textRange = textRange(from: beginningOfDocument, to: endOfDocument),</span><br><span class="line">      <span class="keyword">var</span> unicodes = text(<span class="keyword">in</span>: textRange)?.unicodeScalars <span class="keyword">else</span> &#123; <span class="keyword">return</span> isOutNumber &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ascii: <span class="type">Int</span> = <span class="number">0</span><span class="comment">//ASCII</span></span><br><span class="line">    <span class="keyword">var</span> noAscii: <span class="type">Int</span> = <span class="number">0</span><span class="comment">//汉字，表情</span></span><br><span class="line"></span><br><span class="line">    unicodes.forEach &#123;</span><br><span class="line">      <span class="keyword">if</span> $<span class="number">0</span>.isASCII &#123; ascii += <span class="number">1</span> &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123; noAscii += <span class="number">1</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ascii + noAscii * <span class="number">2</span> &gt; limit &#123;</span><br><span class="line">      isOutNumber = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">let</span> scalar = unicodes.removeLast()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> scalar.isASCII &#123; ascii -= <span class="number">1</span> &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123; noAscii -= <span class="number">1</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> isOutNumber &amp;&amp; cut &#123;</span><br><span class="line">      <span class="keyword">self</span>.replace(textRange, withText: <span class="type">String</span>(unicodes))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> isOutNumber</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span>.text enumerateSubstringsInRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="keyword">self</span>.text.length)</span><br><span class="line">                                      options:<span class="built_in">NSStringEnumerationByComposedCharacterSequences</span></span><br><span class="line">                                   usingBlock:^(<span class="built_in">NSString</span> * _Nullable substring, <span class="built_in">NSRange</span> substringRange, <span class="built_in">NSRange</span> enclosingRange, <span class="built_in">BOOL</span> * _Nonnull stop) &#123;</span><br><span class="line">                          <span class="comment">/// 这里和Swift的character类似，循环每一个字符，针对字符截断。这样就不会出现粘贴的文字表情被错误截断产生错误符号。</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h4 id="markedTextRange"><a href="#markedTextRange" class="headerlink" title="markedTextRange"></a>markedTextRange</h4><p>被标记的文本，这个东西基本上没次都不一样，由于输入的内容不一样，可能是中文，可能是英文，但是在回调中这些标记的文字也在self.text中，这部分文字由于可能存在没有输入完成，所以并不计入最终的内容。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 获取被标记的文本。</span></span><br><span class="line">[<span class="keyword">self</span> textInRange:<span class="keyword">self</span>.markedTextRange];</span><br></pre></td></tr></table></figure>
<h3 id="Placeholder"><a href="#Placeholder" class="headerlink" title="Placeholder"></a>Placeholder</h3><p>UITtextView没有Placeholder着实难受，那就只能自己实现一个了。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)awakeFromNib &#123;</span><br><span class="line">    [<span class="keyword">super</span> awakeFromNib];</span><br><span class="line">    [<span class="keyword">self</span> customInit];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame textContainer:(<span class="built_in">NSTextContainer</span> *)textContainer &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame textContainer:textContainer];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        [<span class="keyword">self</span> customInit];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)customInit &#123;</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textDidChange:) name:<span class="built_in">UITextViewTextDidChangeNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIEdgeInsets</span> inset = <span class="keyword">self</span>.textContainerInset;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.placeholder) &#123;</span><br><span class="line">        [<span class="keyword">self</span>.placeholderLabel sizeToFit];</span><br><span class="line">        <span class="built_in">CGRect</span> newFrame = <span class="keyword">self</span>.placeholderLabel.frame;</span><br><span class="line">        <span class="comment">/// 这里5测试出来的，直接是inset.left会和光标不对齐。</span></span><br><span class="line">        newFrame.origin = <span class="built_in">CGPointMake</span>(inset.left + <span class="number">5</span>, inset.top);</span><br><span class="line">        <span class="keyword">self</span>.placeholderLabel.frame = newFrame;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setText:(<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    [<span class="keyword">super</span> setText:text];</span><br><span class="line">    <span class="keyword">self</span>.placeholderLabel.hidden = <span class="keyword">self</span>.hasText;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setFont:(<span class="built_in">UIFont</span> *)font &#123;</span><br><span class="line">    [<span class="keyword">super</span> setFont:font];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.placeholder) &#123;</span><br><span class="line">        <span class="keyword">self</span>.placeholderLabel.font = font;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)textDidChange:(<span class="built_in">NSNotification</span> *)notification &#123;</span><br><span class="line">    <span class="keyword">self</span>.placeholderLabel.hidden = <span class="keyword">self</span>.hasText;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UILabel</span> *)placeholderLabel &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_placeholderLabel) &#123;</span><br><span class="line">        _placeholderLabel = [<span class="built_in">UILabel</span> new];</span><br><span class="line">        _placeholderLabel.font = <span class="keyword">self</span>.font;</span><br><span class="line">        [<span class="keyword">self</span> customPlaceholderLabel:_placeholderLabel];</span><br><span class="line">        [<span class="keyword">self</span> addSubview:_placeholderLabel];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _placeholderLabel;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)customPlaceholderLabel:(<span class="built_in">UILabel</span> *)placeholderLabel &#123;</span><br><span class="line">    placeholderLabel.textColor = &lt;<span class="meta">#Custom Color#&gt;;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setPlaceholder:(<span class="built_in">NSString</span> *)placeholder &#123;</span><br><span class="line">    _placeholder = placeholder;</span><br><span class="line">    <span class="keyword">self</span>.placeholderLabel.text = placeholder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="UISearchBar"><a href="#UISearchBar" class="headerlink" title="UISearchBar"></a>UISearchBar</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CustomSearchBar</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews &#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    <span class="comment">/// ... custom search bar size.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.searchBar = [CustomSearchBar new];</span><br><span class="line"><span class="keyword">self</span>.searchBar.placeholder = <span class="string">@""</span>;</span><br><span class="line"><span class="keyword">self</span>.searchBar.returnKeyType = <span class="built_in">UIReturnKeySearch</span>;</span><br><span class="line"><span class="keyword">self</span>.searchBar.tintColor = <span class="built_in">UIColor</span>.blackColor;</span><br><span class="line"><span class="keyword">self</span>.searchBar.showsCancelButton = <span class="literal">YES</span>;</span><br><span class="line">[<span class="keyword">self</span>.searchBar setImage:&lt;<span class="meta">#(nullable UIImage *)#&gt; forSearchBarIcon:UISearchBarIconClear state:UIControlStateNormal];</span></span><br><span class="line">[<span class="keyword">self</span>.searchBar setImage:&lt;<span class="meta">#(nullable UIImage *)#&gt; forSearchBarIcon:UISearchBarIconSearch state:UIControlStateNormal];</span></span><br><span class="line"><span class="built_in">UITextField</span> *searchTextField = [<span class="keyword">self</span>.searchBar valueForKey:<span class="string">@"_searchField"</span>];</span><br><span class="line"><span class="comment">/// ...</span></span><br><span class="line"><span class="built_in">UILabel</span> *placeholderLabel = [searchTextField valueForKey:<span class="string">@"_placeholderLabel"</span>];</span><br><span class="line"><span class="comment">/// ...</span></span><br><span class="line"><span class="built_in">UIButton</span> *cancelButton = [<span class="keyword">self</span>.searchBar valueForKey:<span class="string">@"_cancelButton"</span>];</span><br><span class="line"><span class="comment">/// ...</span></span><br><span class="line"><span class="built_in">UIImageView</span> *backgroundImageView = [<span class="keyword">self</span>.searchBar valueForKey:<span class="string">@"_background"</span>];</span><br><span class="line"><span class="comment">/// ...</span></span><br><span class="line"><span class="comment">/// Add searchBar to navigationItem.</span></span><br><span class="line"><span class="keyword">self</span>.navigationItem.titleView = <span class="keyword">self</span>.searchBar;</span><br></pre></td></tr></table></figure>
<p>iOS11更改了搜索栏的样式，与其兼容新老版本不如自己写SearchBar</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">SearchBar</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">SearchBarDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line"><span class="comment">/// 搜索框内部样式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// Default self.bounds</span></span><br><span class="line">- (<span class="built_in">CGRect</span>)searchBar:(SearchBar *)searchBar frameForSearchField:(<span class="built_in">UITextField</span> *)searchField;</span><br><span class="line"><span class="comment">/// Default CGRectZero</span></span><br><span class="line">- (<span class="built_in">CGRect</span>)searchBar:(SearchBar *)searchBar frameForCancelButton:(<span class="built_in">UIButton</span> *)cancelButton;</span><br><span class="line">- (<span class="built_in">CGRect</span>)searchBar:(SearchBar *)searchBar frameForSearchButton:(<span class="built_in">UIButton</span> *)searchButton;</span><br><span class="line">- (<span class="built_in">CGRect</span>)searchBar:(SearchBar *)searchBar frameForClearButton:(<span class="built_in">UIButton</span> *)clearButton;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 搜索框各种事件</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)searchBarShouldBeginEditing:(SearchBar *)searchBar;</span><br><span class="line"><span class="comment">//- (void)searchBarTextDidBeginEditing:(SearchBar *)searchBar;</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)searchBarShouldEndEditing:(SearchBar *)searchBar;</span><br><span class="line"><span class="comment">//- (void)searchBarTextDidEndEditing:(SearchBar *)searchBar;</span></span><br><span class="line">- (<span class="keyword">void</span>)searchBar:(SearchBar *)searchBar textDidChange:(<span class="built_in">NSString</span> *)searchText;</span><br><span class="line">- (<span class="built_in">BOOL</span>)searchBar:(SearchBar *)searchBar shouldChangeTextInRange:(<span class="built_in">NSRange</span>)range replacementText:(<span class="built_in">NSString</span> *)text;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)searchBarSearchButtonClicked:(SearchBar *)searchBar;</span><br><span class="line"><span class="comment">//- (void)searchBarBookmarkButtonClicked:(SearchBar *)searchBar;</span></span><br><span class="line">- (<span class="keyword">void</span>)searchBarCancelButtonClicked:(SearchBar *)searchBar;</span><br><span class="line"><span class="comment">//- (void)searchBarResultsListButtonClicked:(SearchBar *)searchBar;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//- (void)searchBar:(SearchBar *)searchBar selectedScopeButtonIndexDidChange:(NSInteger)selectedScope;</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SearchBar</span>: <span class="title">UIView</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">UITextField</span> *searchField;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *placeholder;</span><br><span class="line"><span class="comment">/// 直接使用_searchField.text会导致无法正确的显示和隐藏clearButton，算是一个小Bug吧（解决方式：使用KVO监听_searchField.text）</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *text;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;SearchBarDelegate&gt; delegate;</span><br><span class="line"><span class="comment">/// 取消</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *cancelButton;</span><br><span class="line"><span class="comment">/// Only support UISearchBarIconSearch and UISearchBarIconClear</span></span><br><span class="line">- (<span class="keyword">void</span>)setImage:(<span class="built_in">UIImage</span> *)iconImage forSearchBarIcon:(<span class="built_in">UISearchBarIcon</span>)icon state:(<span class="built_in">UIControlState</span>)state;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SearchBar</span>() &lt;<span class="title">UITextFieldDelegate</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> searchBar_frameForSearchField_ : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> searchBar_frameForCancelButton_ : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> searchBar_frameForSearchButton_ : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> searchBar_frameForClearButton_ : <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> searchBarShouldBeginEditing_ : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> searchBarShouldEndEditing_ : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> searchBar_textDidChange_ : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> searchBar_shouldChangeTextInRange_replacementText_ : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> searchBarSearchButtonClicked_ : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> searchBarCancelButtonClicked_ : <span class="number">1</span>;</span><br><span class="line">    &#125; _delegateFlags;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/// 搜索</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *searchTextFieldLeftButton;</span><br><span class="line"><span class="comment">/// 清除</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">UIButton</span> *searchTextFieldRightButton;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SearchBar</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.backgroundColor = <span class="built_in">UIColor</span>.clearColor;</span><br><span class="line">        </span><br><span class="line">        _searchTextFieldLeftButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        _searchTextFieldRightButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        [_searchTextFieldRightButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(clearButtonAction:) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">        </span><br><span class="line">        _searchField = [[<span class="built_in">UITextField</span> alloc] initWithFrame:<span class="keyword">self</span>.bounds];</span><br><span class="line">        _searchField.returnKeyType = <span class="built_in">UIReturnKeySearch</span>;</span><br><span class="line">        _searchField.delegate = <span class="keyword">self</span>;</span><br><span class="line">        _searchField.leftView = _searchTextFieldLeftButton;</span><br><span class="line">        _searchField.leftViewMode = <span class="built_in">UITextFieldViewModeAlways</span>;</span><br><span class="line">        _searchField.rightView = _searchTextFieldRightButton;</span><br><span class="line">        _searchField.rightViewMode = <span class="built_in">UITextFieldViewModeAlways</span>;</span><br><span class="line">        _searchTextFieldRightButton.hidden = <span class="literal">YES</span>;</span><br><span class="line">        [<span class="keyword">self</span> addSubview:_searchField];</span><br><span class="line">        </span><br><span class="line">        _cancelButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        [_cancelButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(cancelButtonAction:) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">        [<span class="keyword">self</span> addSubview:_cancelButton];</span><br><span class="line">        </span><br><span class="line">        [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(textFieldTextDidChangeNotificationAction:) name:<span class="built_in">UITextFieldTextDidChangeNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)layoutSubviews &#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    [_cancelButton sizeToFit];</span><br><span class="line">    _cancelButton.frame = _delegateFlags.searchBar_frameForCancelButton_ ? [_delegate searchBar:<span class="keyword">self</span> frameForCancelButton:_cancelButton] : <span class="built_in">CGRectZero</span>;</span><br><span class="line">    </span><br><span class="line">    _searchField.frame = _delegateFlags.searchBar_frameForSearchField_ ? [_delegate searchBar:<span class="keyword">self</span> frameForSearchField:_searchField] : <span class="keyword">self</span>.bounds;</span><br><span class="line">    </span><br><span class="line">    [_searchTextFieldLeftButton sizeToFit];</span><br><span class="line">    _searchTextFieldLeftButton.frame = _delegateFlags.searchBar_frameForSearchButton_ ? [_delegate searchBar:<span class="keyword">self</span> frameForSearchButton:_searchTextFieldLeftButton] : _searchTextFieldLeftButton.frame;</span><br><span class="line">    </span><br><span class="line">    [_searchTextFieldRightButton sizeToFit];</span><br><span class="line">    _searchTextFieldRightButton.frame = _delegateFlags.searchBar_frameForClearButton_ ? [_delegate searchBar:<span class="keyword">self</span> frameForClearButton:_searchTextFieldRightButton] : _searchTextFieldRightButton.frame;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">BOOL</span>)resignFirstResponder &#123;</span><br><span class="line">    <span class="keyword">return</span> [_searchField resignFirstResponder];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)clearButtonAction:(<span class="built_in">UIButton</span> *)sender &#123;</span><br><span class="line">    sender.hidden = <span class="literal">YES</span>;</span><br><span class="line">    _searchField.text = <span class="string">@""</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (_delegateFlags.searchBar_textDidChange_) &#123;</span><br><span class="line">        [_delegate searchBar:<span class="keyword">self</span> textDidChange:<span class="string">@""</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)cancelButtonAction:(<span class="built_in">UIButton</span> *)sender &#123;</span><br><span class="line">    <span class="keyword">if</span> (_delegateFlags.searchBarCancelButtonClicked_) &#123;</span><br><span class="line">        [_delegate searchBarCancelButtonClicked:<span class="keyword">self</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)setImage:(<span class="built_in">UIImage</span> *)iconImage forSearchBarIcon:(<span class="built_in">UISearchBarIcon</span>)icon state:(<span class="built_in">UIControlState</span>)state &#123;</span><br><span class="line">    <span class="keyword">switch</span> (icon) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">UISearchBarIconSearch</span>: &#123;</span><br><span class="line">            [_searchTextFieldLeftButton setImage:iconImage forState:state];</span><br><span class="line">        &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">UISearchBarIconClear</span>: &#123;</span><br><span class="line">            [_searchTextFieldRightButton setImage:iconImage forState:state];</span><br><span class="line">        &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)setDelegate:(<span class="keyword">id</span>&lt;SearchBarDelegate&gt;)delegate &#123;</span><br><span class="line">    _delegate = delegate;</span><br><span class="line">    </span><br><span class="line">    _delegateFlags.searchBar_frameForSearchField_ = [_delegate respondsToSelector:<span class="keyword">@selector</span>(searchBar:frameForSearchField:)];</span><br><span class="line">    _delegateFlags.searchBar_frameForCancelButton_ = [_delegate respondsToSelector:<span class="keyword">@selector</span>(searchBar:frameForCancelButton:)];</span><br><span class="line">    _delegateFlags.searchBar_frameForSearchButton_ = [_delegate respondsToSelector:<span class="keyword">@selector</span>(searchBar:frameForSearchButton:)];</span><br><span class="line">    _delegateFlags.searchBar_frameForClearButton_ = [_delegate respondsToSelector:<span class="keyword">@selector</span>(searchBar:frameForClearButton:)];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    _delegateFlags.searchBarShouldBeginEditing_ = [_delegate respondsToSelector:<span class="keyword">@selector</span>(searchBarShouldBeginEditing:)];</span><br><span class="line">    _delegateFlags.searchBarShouldEndEditing_ = [_delegate respondsToSelector:<span class="keyword">@selector</span>(searchBarShouldEndEditing:)];</span><br><span class="line">    _delegateFlags.searchBar_textDidChange_ = [_delegate respondsToSelector:<span class="keyword">@selector</span>(searchBar:textDidChange:)];</span><br><span class="line">    _delegateFlags.searchBar_shouldChangeTextInRange_replacementText_ = [_delegate respondsToSelector:<span class="keyword">@selector</span>(searchBar:shouldChangeTextInRange:replacementText:)];</span><br><span class="line">    _delegateFlags.searchBarSearchButtonClicked_ = [_delegate respondsToSelector:<span class="keyword">@selector</span>(searchBarSearchButtonClicked:)];</span><br><span class="line">    _delegateFlags.searchBarCancelButtonClicked_ = [_delegate respondsToSelector:<span class="keyword">@selector</span>(searchBarCancelButtonClicked:)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark selecotr delegate</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)textFieldShouldBeginEditing:(<span class="built_in">UITextField</span> *)textField &#123;</span><br><span class="line">    <span class="keyword">return</span> _delegateFlags.searchBarShouldBeginEditing_ ? [_delegate searchBarShouldBeginEditing:<span class="keyword">self</span>] : <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">BOOL</span>)textFieldShouldEndEditing:(<span class="built_in">UITextField</span> *)textField &#123;</span><br><span class="line">    <span class="keyword">return</span> _delegateFlags.searchBarShouldEndEditing_ ? [_delegate searchBarShouldEndEditing:<span class="keyword">self</span>] : <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">BOOL</span>)textField:(<span class="built_in">UITextField</span> *)textField shouldChangeCharactersInRange:(<span class="built_in">NSRange</span>)range replacementString:(<span class="built_in">NSString</span> *)string &#123;</span><br><span class="line">    <span class="keyword">return</span> _delegateFlags.searchBar_shouldChangeTextInRange_replacementText_ ? [_delegate searchBar:<span class="keyword">self</span> shouldChangeTextInRange:range replacementText:string] : <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">BOOL</span>)textFieldShouldReturn:(<span class="built_in">UITextField</span> *)textField &#123;</span><br><span class="line">    <span class="keyword">if</span> (_delegateFlags.searchBarSearchButtonClicked_) &#123;</span><br><span class="line">        [_delegate searchBarSearchButtonClicked:<span class="keyword">self</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)textFieldTextDidChangeNotificationAction:(<span class="built_in">NSNotification</span> *)sender &#123;</span><br><span class="line">    _searchTextFieldRightButton.hidden = _searchField.text.length == <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (_delegateFlags.searchBar_textDidChange_) &#123;</span><br><span class="line">        [_delegate searchBar:<span class="keyword">self</span> textDidChange:_searchField.text];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#pragma mark easy property</span></span><br><span class="line">- (<span class="built_in">NSString</span> *)placeholder &#123;</span><br><span class="line">    <span class="keyword">return</span> _searchField.placeholder;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)setPlaceholder:(<span class="built_in">NSString</span> *)placeholder &#123;</span><br><span class="line">    _searchField.placeholder = placeholder;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    <span class="keyword">return</span> _searchField.text;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)setText:(<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    _searchField.text = text;</span><br><span class="line">    _searchTextFieldRightButton.hidden = text.length == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="UIDatePicker"><a href="#UIDatePicker" class="headerlink" title="UIDatePicker"></a>UIDatePicker</h2><p>日期选择器</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.picker = [[<span class="built_in">UIDatePicker</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">40</span>, KScreenWidth, <span class="number">180</span>)];</span><br><span class="line"><span class="keyword">self</span>.picker.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line"><span class="keyword">self</span>.picker.datePickerMode = <span class="built_in">UIDatePickerModeDate</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 获取日期。</span></span><br><span class="line"><span class="keyword">self</span>.picker.date</span><br></pre></td></tr></table></figure>
<h2 id="UINavigationBar"><a href="#UINavigationBar" class="headerlink" title="UINavigationBar"></a>UINavigationBar</h2><p><img src="/images/2017-12-28-iOS/4.png" alt=""></p>
<p><img src="/images/2017-12-28-iOS/3.png" alt=""></p>
<h3 id="UINavigationItem"><a href="#UINavigationItem" class="headerlink" title="UINavigationItem"></a>UINavigationItem</h3><h2 id="UIVisualEffectView"><a href="#UIVisualEffectView" class="headerlink" title="UIVisualEffectView"></a>UIVisualEffectView</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 修改模糊背景颜色</span></span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">UIView</span> *view <span class="keyword">in</span> &lt;<span class="meta">#(UIVisualEffectView)#&gt;.subviews) &#123;</span></span><br><span class="line">   <span class="keyword">if</span> ([view isMemberOfClass:<span class="built_in">NSClassFromString</span>(<span class="string">@"_UIVisualEffectSubview"</span>)]) &#123;</span><br><span class="line">       view.backgroundColor = [<span class="built_in">UIColor</span> colorWithRed:&lt;<span class="meta">#(CGFloat)#&gt; green:<span class="meta-string">&lt;#(CGFloat)#&gt;</span> blue:<span class="meta-string">&lt;#(CGFloat)#&gt;</span> alpha:<span class="meta-string">&lt;#(CGFloat)#&gt;</span>];</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="UIViewController"><a href="#UIViewController" class="headerlink" title="UIViewController"></a>UIViewController</h2><h3 id="Enable-interactive-pop-gesture-recognizer-with-custom-back-button"><a href="#Enable-interactive-pop-gesture-recognizer-with-custom-back-button" class="headerlink" title="Enable interactive pop gesture recognizer with custom back button"></a>Enable interactive pop gesture recognizer with custom back button</h3><p>自定义返回按钮导致系统滑动手势失败解决。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIButton</span> *backButton = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">[backButton setImage:[<span class="built_in">UIImage</span> imageNamed:&lt;<span class="meta">#(nonnull NSString *)#&gt;] forState:UIControlStateNormal];</span></span><br><span class="line">[backButton addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(backAction:) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line"><span class="keyword">self</span>.navigationItem.leftBarButtonItem = [[<span class="built_in">UIBarButtonItem</span> alloc] initWithCustomView:backButton];</span><br><span class="line"><span class="keyword">self</span>.navigationItem.hidesBackButton = <span class="literal">YES</span>;</span><br><span class="line"><span class="keyword">self</span>.navigationController.interactivePopGestureRecognizer.delegate = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)backAction:(<span class="built_in">UIButton</span> *)sender &#123;</span><br><span class="line">    [<span class="keyword">self</span>.navigationController popViewControllerAnimated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Transition"><a href="#Transition" class="headerlink" title="Transition"></a>Transition</h3><p><img src="/images/2017-12-28-iOS/2.png" alt=""></p>
<p>presente transition的默认过程是创建一个UIPresentationController，将prestatingViewController的rootViewController的subViewControllers压栈，将prestationController</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// x.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TransitionManager</span> : <span class="title">NSObject</span> &lt;<span class="title">UIViewControllerTransitioningDelegate</span>, <span class="title">UIViewControllerAnimatedTransitioning</span>&gt;</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">///x.m</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PresentationController</span>: <span class="title">UIPresentationController</span></span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *dimmingView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PresentationController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithPresentedViewController:(<span class="built_in">UIViewController</span> *)presentedViewController presentingViewController:(<span class="built_in">UIViewController</span> *)presentingViewController &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithPresentedViewController:presentedViewController presentingViewController:presentingViewController];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dimmingView = [<span class="built_in">UIView</span> new];</span><br><span class="line">        <span class="keyword">self</span>.dimmingView.backgroundColor = &lt;<span class="meta">#Custom Dimming Background Color#&gt;;</span></span><br><span class="line">        [<span class="keyword">self</span>.dimmingView addGestureRecognizer:[[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(dismissAction)]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)presentationTransitionWillBegin &#123;</span><br><span class="line">    <span class="keyword">self</span>.dimmingView.frame = <span class="keyword">self</span>.containerView.bounds;</span><br><span class="line">    <span class="keyword">self</span>.dimmingView.alpha = <span class="number">0</span>;</span><br><span class="line">    [<span class="keyword">self</span>.containerView addSubview:<span class="keyword">self</span>.dimmingView];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 动画同时进行。</span></span><br><span class="line">    [<span class="keyword">self</span>.presentedViewController.transitionCoordinator animateAlongsideTransition:^(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerTransitionCoordinatorContext</span>&gt;  _Nonnull context) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dimmingView.alpha = <span class="number">0.6</span>;</span><br><span class="line">    &#125; completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dismissalTransitionWillBegin &#123;</span><br><span class="line">    [<span class="keyword">self</span>.presentedViewController.transitionCoordinator animateAlongsideTransition:^(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerTransitionCoordinatorContext</span>&gt;  _Nonnull context) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dimmingView.alpha = <span class="number">0</span>;</span><br><span class="line">    &#125; completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dismissAction &#123;</span><br><span class="line">    [<span class="keyword">self</span>.presentedViewController dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">TransitionManager</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)animateTransition:(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerContextTransitioning</span>&gt;)transitionContext &#123;</span><br><span class="line">    <span class="built_in">UIView</span> *containerView = transitionContext.containerView;</span><br><span class="line">    <span class="built_in">UIViewController</span> *fromVC = [transitionContext viewControllerForKey:<span class="built_in">UITransitionContextFromViewControllerKey</span>];</span><br><span class="line">    <span class="built_in">UIViewController</span> *toVC = [transitionContext viewControllerForKey:<span class="built_in">UITransitionContextToViewControllerKey</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGRect</span> endFrame = [transitionContext finalFrameForViewController:toVC];</span><br><span class="line">    <span class="built_in">CGRect</span> startFrame = endFrame;</span><br><span class="line">    startFrame.origin.y = containerView.frame.size.height;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (toVC.isBeingPresented) &#123;</span><br><span class="line">        [containerView addSubview:toVC.view];</span><br><span class="line">        toVC.view.frame = startFrame;</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:[<span class="keyword">self</span> transitionDuration:transitionContext] animations:^&#123;</span><br><span class="line">            toVC.view.frame = endFrame;</span><br><span class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">            [transitionContext completeTransition:finished];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="built_in">UIView</span> animateWithDuration:[<span class="keyword">self</span> transitionDuration:transitionContext] animations:^&#123;</span><br><span class="line">            fromVC.view.frame = startFrame;</span><br><span class="line">        &#125; completion:^(<span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">            [transitionContext completeTransition:finished];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSTimeInterval</span>)transitionDuration:(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerContextTransitioning</span>&gt;)transitionContext &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UIViewControllerTransitioningDelegate</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIPresentationController</span> *)presentationControllerForPresentedViewController:(<span class="built_in">UIViewController</span> *)presented presentingViewController:(<span class="built_in">UIViewController</span> *)presenting sourceViewController:(<span class="built_in">UIViewController</span> *)source &#123;</span><br><span class="line">    <span class="keyword">return</span> [[PresentationController alloc] initWithPresentedViewController:presented presentingViewController:presenting];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForPresentedController:(<span class="built_in">UIViewController</span> *)presented presentingController:(<span class="built_in">UIViewController</span> *)presenting sourceController:(<span class="built_in">UIViewController</span> *)source &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerAnimatedTransitioning</span>&gt;)animationControllerForDismissedController:(<span class="built_in">UIViewController</span> *)dismissed &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/seedante/iOS-Note/wiki/ViewController-Transition" target="_blank" rel="noopener">iOS 视图控制器转场详解</a></p>
<ol>
<li>如何动态弹出高度？意味着弹出的高度不是固定的，在弹出之前就应该算好高度，这无疑需要提前渲染，然后计算内容高度，然后弹出。在这里我想到了一种简便的方法：</li>
</ol>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 在layoutsubviews中修改view的y值。</span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLayoutSubviews &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLayoutSubviews];</span><br><span class="line">    <span class="comment">/// 在这里仅改变view的frame.origin.y，来达到自定义弹出高度。</span></span><br><span class="line">    <span class="built_in">CGRect</span> newFrame = <span class="keyword">self</span>.view.frame;</span><br><span class="line">    newFrame.origin.y = <span class="keyword">self</span>.view.bounds.size.height - <span class="keyword">self</span>.markedView.frame.origin.y;</span><br><span class="line">    <span class="keyword">self</span>.view.frame = newFrame;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="UIAlertController"><a href="#UIAlertController" class="headerlink" title="UIAlertController"></a>UIAlertController</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 简单弹出一个提示框</span></span><br><span class="line"><span class="built_in">UIAlertController</span> *alert = [<span class="built_in">UIAlertController</span> alertControllerWithTitle:&lt;<span class="meta">#(nullable NSString *)#&gt; message:<span class="meta-string">&lt;#(nullable NSString *)#&gt;</span> preferredStyle:UIAlertControllerStyleAlert];</span></span><br><span class="line"><span class="built_in">UIAlertAction</span> *leftAction = [<span class="built_in">UIAlertAction</span> actionWithTitle:&lt;<span class="meta">#(nullable NSString *)#&gt; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span></span><br><span class="line">&#125;];</span><br><span class="line"><span class="built_in">UIAlertAction</span> *rightAction = [<span class="built_in">UIAlertAction</span> actionWithTitle:&lt;<span class="meta">#(nullable NSString *)#&gt; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[leftAction setValue:[<span class="built_in">UIColor</span> blackColor] forKey:<span class="string">@"titleTextColor"</span>];</span><br><span class="line">[rightAction setValue:[<span class="built_in">UIColor</span> redColor] forKey:<span class="string">@"titleTextColor"</span>];</span><br><span class="line"></span><br><span class="line">[alert addAction:leftAction];</span><br><span class="line">[alert addAction:rightAction];</span><br><span class="line"></span><br><span class="line">[controller presentViewController:alert animated:<span class="literal">YES</span> completion:^&#123;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h2 id="UIImagePickerController"><a href="#UIImagePickerController" class="headerlink" title="UIImagePickerController"></a>UIImagePickerController</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">_imagePickerController = [[<span class="built_in">UIImagePickerController</span> alloc] init];</span><br><span class="line">_imagePickerController.sourceType = <span class="built_in">UIImagePickerControllerSourceTypePhotoLibrary</span>;</span><br><span class="line"><span class="comment">/// 是否可编辑</span></span><br><span class="line">_imagePickerController.allowsEditing = <span class="literal">YES</span>;</span><br><span class="line">_imagePickerController.delegate = <span class="keyword">self</span>;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/// UIImagePickerControllerDelegate</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)imagePickerController:(<span class="built_in">UIImagePickerController</span> *)picker didFinishPickingImage:(<span class="built_in">UIImage</span> *)image editingInfo:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)editingInfo &#123;</span><br><span class="line">    [picker dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)imagePickerControllerDidCancel:(<span class="built_in">UIImagePickerController</span> *)picker &#123;</span><br><span class="line">    [picker dismissViewControllerAnimated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Summary-1"><a href="#Summary-1" class="headerlink" title="Summary"></a>Summary</h1><h2 id="if、else-Vs-Inherit"><a href="#if、else-Vs-Inherit" class="headerlink" title="if、else Vs Inherit"></a>if、else Vs Inherit</h2><p>开发中遇到的很多相似的界面，很多开发者都会用复用，并用if、else来区分当前界面处理的是那种情况，在开发前期基本没有问题。但是一旦别人接收你的代码，再改需求的时候就会出现非常混乱的代码。所以这种情况建议分开，相同的逻辑可以放在基类中实现（业务代码除外，这里的通用处理指的是下拉刷新逻辑、谈提示的样式、Loading的弹出等和业务无关的代码）。</p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"># iOS</a>
          
            <a href="/tags/Objective-C/" rel="tag"># Objective-C</a>
          
            <a href="/tags/Swift-3-2-0/" rel="tag"># Swift 3.2.0</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/11/15/Reverse/" rel="next" title="Reverse">
                <i class="fa fa-chevron-left"></i> Reverse
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/01/08/Marco/" rel="prev" title="Marco">
                Marco <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/head.png"
                alt="Mini灬哆啦" />
            
              <p class="site-author-name" itemprop="name">Mini灬哆啦</p>
              <p class="site-description motion-element" itemprop="description">It's only a matter of time</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">24</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">33</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/XWJACK/" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Signature"><span class="nav-number">1.</span> <span class="nav-text">Signature</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Device"><span class="nav-number">2.</span> <span class="nav-text">Device</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#UIKit"><span class="nav-number">3.</span> <span class="nav-text">UIKit</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#UIWindow"><span class="nav-number">3.1.</span> <span class="nav-text">UIWindow</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UIView"><span class="nav-number">3.2.</span> <span class="nav-text">UIView</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Touch-Events"><span class="nav-number">3.2.1.</span> <span class="nav-text">Touch Events</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#point-inside-with"><span class="nav-number">3.2.1.1.</span> <span class="nav-text">point(inside:with:)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hitTest-with"><span class="nav-number">3.2.1.2.</span> <span class="nav-text">hitTest(_:with:)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Animation"><span class="nav-number">3.2.2.</span> <span class="nav-text">Animation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UIScrollView"><span class="nav-number">3.3.</span> <span class="nav-text">UIScrollView</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UITableView"><span class="nav-number">3.4.</span> <span class="nav-text">UITableView</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#reloadData"><span class="nav-number">3.4.1.</span> <span class="nav-text">reloadData</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#How-to-keep-UITableView-contentOffset-after-calling-reloadData"><span class="nav-number">3.4.1.1.</span> <span class="nav-text">How to keep UITableView contentOffset after calling reloadData</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MJRefresh"><span class="nav-number">3.4.2.</span> <span class="nav-text">MJRefresh</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#解决下拉刷新无法回弹的问题"><span class="nav-number">3.4.2.1.</span> <span class="nav-text">解决下拉刷新无法回弹的问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Summary"><span class="nav-number">3.4.3.</span> <span class="nav-text">Summary</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#一个TableView中多种样式相似的Cell"><span class="nav-number">3.4.3.1.</span> <span class="nav-text">一个TableView中多种样式相似的Cell</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#动态显示"><span class="nav-number">3.4.3.1.1.</span> <span class="nav-text">动态显示</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#优雅的唯一表示一个Cell"><span class="nav-number">3.4.3.2.</span> <span class="nav-text">优雅的唯一表示一个Cell</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UICollectionView"><span class="nav-number">3.5.</span> <span class="nav-text">UICollectionView</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Horizontal-refresh"><span class="nav-number">3.5.1.</span> <span class="nav-text">Horizontal refresh</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#selected-muti-selected"><span class="nav-number">3.5.2.</span> <span class="nav-text">selected muti-selected</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UICollectionViewFlowLayout"><span class="nav-number">3.5.3.</span> <span class="nav-text">UICollectionViewFlowLayout</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UITextView"><span class="nav-number">3.6.</span> <span class="nav-text">UITextView</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UITextView-with-auto-size"><span class="nav-number">3.6.1.</span> <span class="nav-text">UITextView with auto size.</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Limit-number-of-character"><span class="nav-number">3.6.2.</span> <span class="nav-text">Limit number of character</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#markedTextRange"><span class="nav-number">3.6.2.1.</span> <span class="nav-text">markedTextRange</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Placeholder"><span class="nav-number">3.6.3.</span> <span class="nav-text">Placeholder</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UISearchBar"><span class="nav-number">3.7.</span> <span class="nav-text">UISearchBar</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UIDatePicker"><span class="nav-number">3.8.</span> <span class="nav-text">UIDatePicker</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UINavigationBar"><span class="nav-number">3.9.</span> <span class="nav-text">UINavigationBar</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UINavigationItem"><span class="nav-number">3.9.1.</span> <span class="nav-text">UINavigationItem</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UIVisualEffectView"><span class="nav-number">3.10.</span> <span class="nav-text">UIVisualEffectView</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UIViewController"><span class="nav-number">3.11.</span> <span class="nav-text">UIViewController</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Enable-interactive-pop-gesture-recognizer-with-custom-back-button"><span class="nav-number">3.11.1.</span> <span class="nav-text">Enable interactive pop gesture recognizer with custom back button</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Transition"><span class="nav-number">3.11.2.</span> <span class="nav-text">Transition</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UIAlertController"><span class="nav-number">3.12.</span> <span class="nav-text">UIAlertController</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UIImagePickerController"><span class="nav-number">3.13.</span> <span class="nav-text">UIImagePickerController</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Summary-1"><span class="nav-number">4.</span> <span class="nav-text">Summary</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#if、else-Vs-Inherit"><span class="nav-number">4.1.</span> <span class="nav-text">if、else Vs Inherit</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mini灬哆啦</span>

  

  
</div>











        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="Total Visitors">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="Total Views">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



  






<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    
      <script type="text/javascript">
      function renderGitment(){
        var gitment = new Gitmint({
            id: window.location.pathname,
            owner: 'XWJACK',
            repo: 'xwjack.github.io',
            
            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,
            
            oauth: {
            
            
                client_secret: 'b1fe01f8c1aed22c0e78e5b65ac4793bb1433707',
            
                client_id: '63a97a6fabe1ee5265d1'
            }});
        gitment.render('gitment-container');
      }

      
      renderGitment();
      
      </script>
    






  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
